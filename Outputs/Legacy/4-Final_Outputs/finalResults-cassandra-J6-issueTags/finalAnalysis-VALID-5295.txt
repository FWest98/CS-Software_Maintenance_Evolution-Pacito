Pattern changes caused by commit: 755522d079fb32697ecde380c4ab7e0b5974ad03

From: Decorator-1
To:   Decorator-0

From: Facade-1
To:   Facade-0

From: Flyweight-4
To:   Flyweight-5

From: Strategy-1
To:   Strategy-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-5295.txt 

commit 755522d079fb32697ecde380c4ab7e0b5974ad03
Author: Brandon Williams <brandonwilliams@apache.org>

    Prevent nodes that failed to join from being stuck in the joining state
    indefinitely.
    Patch by brandonwilliams, reviewed by Paul Cannon for CASSANDRA-3351



==================================
 Issue CASSANDRA-3351 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3351] If node fails to join a ring it will stay in joining state indefinately
-----------------

-----------------
Summary: If node fails to join a ring it will stay in joining state indefinately
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Wed, 12 Oct 2011 00:34:21 +0000
-----------------

-----------------
Resolved at: Fri, 21 Oct 2011 22:26:47 +0000
-----------------

-----------------
Assigned to: Brandon Williams
-----------------

-----------------
Description: 

While attempting to add a new node to my ring something went wrong and I had to terminate
the node on ec2. After this the node keeps appearing in the ring command in "joining"
state and never goes away. Per driftx on the Cassandra channel if I do a whole cluster
restart it should go away, but since this is a production system this is not really
possible. Additionally if I could join a node with same IP again this should go away, but
being on ec2 this is not always easy. So not sure if this truly qualifies as a bug or more
like a feature request, but I feel there should be a way to remove a node in any state if
I wish without joining a node with same ip or doing a whole cluster restart.
 

-----------------

-----------------
Comments: 

New Comment: 
Also per driftx I ran gms trace and grabbed about 1 minute worth of log entries that I
have attached here. Problem node ip is 10.82.211.8 


New Comment: 
Two problems introduced in <a href="https://issues.apache.org/jira/browse/CASSANDRA-2496"
title="Gossip should handle &#39;dead&#39; states" class="issue-link"
data-issue-key="CASSANDRA-2496"><del>CASSANDRA-2496</del></a>: the fatclient logic was
changed a bit too much, and the isDeadState check was assuming fat clients had dead state,
thus calling setHasToken to effectively not mark  them as fat clients. 


New Comment: 
+1 


New Comment: 
Committed. 


