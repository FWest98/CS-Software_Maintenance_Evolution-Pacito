Pattern changes caused by commit: cef35c0c68f8eae76fbb99424fa0cc8712e4d7d8

From: Facade-1
To:   Facade-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-5566.txt 

commit cef35c0c68f8eae76fbb99424fa0cc8712e4d7d8
Author: Jonathan Ellis <jbellis@apache.org>

    fix adding to leveled manifest after streaming
    patch by jbellis; reviewed by Ben Coverston and tested by Joe Siegrist for CASSANDRA-3536



==================================
 Issue CASSANDRA-3536 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3536] Assertion error during bootstraping cassandra
-----------------

-----------------
Summary: Assertion error during bootstraping cassandra
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Mon, 28 Nov 2011 17:44:23 +0000
-----------------

-----------------
Resolved at: Fri, 2 Dec 2011 15:47:17 +0000
-----------------

-----------------
Assigned to: Jonathan Ellis
-----------------

-----------------
Description: 

 I have a 3 node cassandra cluster. I have RF set to 3 and do reads<br/>and writes using
QUORUM.

Here is my initial ring configuration

<span class="error">&#91;root@CAP4-CNode1
~&#93;</span># /root/cassandra/bin/nodetool -h localhost ring<br/>Address         DC      
   Rack        Status State   Load<br/>Owns    Token

      
113427455640312821154458202477256070484<br/>10.19.104.11    datacenter1 rack1       Up    
Normal  1.66 GB<br/>33.33%  0<br/>10.19.104.12    datacenter1 rack1       Up     Normal 
1.06 GB<br/>33.33%  56713727820156410577229101238628035242<br/>10.19.104.13    datacenter1
rack1       Up     Normal  1.61 GB<br/>33.33%  113427455640312821154458202477256070484

I
want to add 10.19.104.14 to the cluster.

I edited the 10.19.104.14 cassandra.yaml file
and set the token to<br/>127605887595351923798765477786913079296 and set auto_bootstrap
to<br/>true.

When I started cassandra I am getting Assertion Error. 


thanks<br/>Ramesh

<span class="error">&#91;root@CAP4-CNode4 cassandra&#93;</span># 
INFO 10:29:46,093 Logging initialized<br/> INFO 10:29:46,099 JVM vendor/version: Java
HotSpot(TM) 64-Bit Server<br/>VM/1.6.0_25<br/> INFO 10:29:46,100 Heap size:
8304721920/8304721920<br/> INFO 10:29:46,100
Classpath:<br/>bin/../conf:bin/../build/classes/main:bin/../build/classes/thrift:bin/../lib/antlr-3.2.jar:bin/../lib/apache-cassandra-1.0.2.jar:bin/../lib/apache-cassandra-clientutil-1.0.2.jar:bin/../lib/apache-cassandra-thrift-1.0.2.jar:bin/../lib/avro-1.4.0-fixes.jar:bin/../lib/avro-1.4.0-sources-fixes.jar:bin/../lib/commons-cli-1.1.jar:bin/../lib/commons-codec-1.2.jar:bin/../lib/commons-lang-2.4.jar:bin/../lib/compress-lzf-0.8.4.jar:bin/../lib/concurrentlinkedhashmap-lru-1.2.jar:bin/../lib/guava-r08.jar:bin/../lib/high-scale-lib-1.1.2.jar:bin/../lib/jackson-core-asl-1.4.0.jar:bin/../lib/jackson-mapper-asl-1.4.0.jar:bin/../lib/jamm-0.2.5.jar:bin/../lib/jline-0.9.94.jar:bin/../lib/jna.jar:bin/../lib/json-simple-1.1.jar:bin/../lib/libthrift-0.6.jar:bin/../lib/log4j-1.2.16.jar:bin/../lib/mx4j-examples.jar:bin/../lib/mx4j-impl.jar:bin/../lib/mx4j.jar:bin/../lib/mx4j-jmx.jar:bin/../lib/mx4j-remote.jar:bin/../lib/mx4j-rimpl.jar:bin/../lib/mx4j-rjmx.jar:bin/../lib/mx4j-tools.jar:bin/../lib/servlet-api-2.5-20081211.jar:bin/../lib/slf4j-api-1.6.1.jar:bin/../lib/slf4j-log4j12-1.6.1.jar:bin/../lib/snakeyaml-1.6.jar:bin/../lib/snappy-java-1.0.4.1.jar:bin/../lib/jamm-0.2.5.jar<br/>
INFO 10:29:48,713 JNA mlockall successful<br/> INFO 10:29:48,726 Loading settings
from<br/><a href="file:/root/apache-cassandra-1.0.2/conf/cassandra.yaml"
class="external-link"
rel="nofollow">file:/root/apache-cassandra-1.0.2/conf/cassandra.yaml</a><br/> INFO
10:29:48,883 DiskAccessMode 'auto' determined to be mmap,<br/>indexAccessMode is mmap<br/>
INFO 10:29:48,898 Global memtable threshold is enabled at 2640MB<br/> INFO 10:29:49,203
Couldn't detect any schema definitions in local storage.<br/> INFO 10:29:49,204 Found
table data in data directories. Consider<br/>using the CLI to define your schema.<br/>
INFO 10:29:49,220 Creating new commitlog
segment<br/>/var/lib/cassandra/commitlog/CommitLog-1321979389220.log<br/> INFO
10:29:49,227 No commitlog files found; skipping replay<br/> INFO 10:29:49,230 Cassandra
version: 1.0.2<br/> INFO 10:29:49,230 Thrift API version: 19.18.0<br/> INFO 10:29:49,230
Loading persisted ring state<br/> INFO 10:29:49,235 Starting up server gossip<br/> INFO
10:29:49,259 Enqueuing flush of<br/>Memtable-LocationInfo@122130810(192/240
serialized/live bytes, 4 ops)<br/> INFO 10:29:49,260 Writing
Memtable-LocationInfo@122130810(192/240<br/>serialized/live bytes, 4 ops)<br/> INFO
10:29:49,317 Completed
flushing<br/>/var/lib/cassandra/data/system/LocationInfo-h-1-Data.db (300 bytes)<br/> INFO
10:29:49,340 Starting Messaging Service on port 7000<br/> INFO 10:29:49,349 JOINING:
waiting for ring and schema information<br/> INFO 10:29:50,759 Applying
migration<br/>4b0e20f0-1511-11e1-0000-c11bc95834d7 Add keyspace: MSA,
rep<br/>strategy:SimpleStrategy{}, durable_writes: true<br/> INFO 10:29:50,761 Enqueuing
flush of<br/>Memtable-Migrations@1507565381(6744/8430 serialized/live bytes, 1 ops)<br/>
INFO 10:29:50,761 Writing Memtable-Migrations@1507565381(6744/8430<br/>serialized/live
bytes, 1 ops)<br/> INFO 10:29:50,761 Enqueuing flush
of<br/>Memtable-Schema@1498835564(2889/3611 serialized/live bytes, 3 ops)<br/> INFO
10:29:50,776 Completed flushing<br/>/var/lib/cassandra/data/system/Migrations-h-1-Data.db
(6808 bytes)<br/> INFO 10:29:50,777 Writing
Memtable-Schema@1498835564(2889/3611<br/>serialized/live bytes, 3 ops)<br/> INFO
10:29:50,797 Completed flushing<br/>/var/lib/cassandra/data/system/Schema-h-1-Data.db
(3039 bytes)<br/> INFO 10:29:50,814 Applying
migration<br/>4b6f2cb0-1511-11e1-0000-c11bc95834d7 Add column
family:<br/>org.apache.cassandra.config.CFMetaData@1639d811[cfId=1000,ksName=MSA,cfName=modseq,cfType=Standard,comparator=org.apache.cassandra.db.marshal.ReversedType(org.apache.cassandra.db.marshal.BytesType),subcolumncomparator=&lt;null&gt;,comment=,rowCacheSize=0.0,keyCacheSize=5000000.0,readRepairChance=1.0,replicateOnWrite=true,gcGraceSeconds=3600,defaultValidator=org.apache.cassandra.db.marshal.BytesType,keyValidator=org.apache.cassandra.db.marshal.BytesType,minCompactionThreshold=4,maxCompactionThreshold=32,rowCacheSavePeriodInSeconds=0,keyCacheSavePeriodInSeconds=14400,rowCacheKeysToSave=2147483647,rowCacheProvider=org.apache.cassandra.cache.SerializingCacheProvider@2f984f7d,mergeShardsChance=0.1,keyAlias=&lt;null&gt;,column_metadata={},compactionStrategyClass=class<br/>org.apache.cassandra.db.compaction.LeveledCompactionStrategy,compactionStrategyOptions=
{sstable_size_in_mb=10},compressionOptions={}]<br/>
INFO 10:29:50,815 Enqueuing flush of<br/>Memtable-Migrations@948613108(7482/9352
serialized/live bytes, 1 ops)<br/> INFO 10:29:50,816 Writing
Memtable-Migrations@948613108(7482/9352<br/>serialized/live bytes, 1 ops)<br/> INFO
10:29:50,816 Enqueuing flush of<br/>Memtable-Schema@421910828(3294/4117 serialized/live
bytes, 3 ops)<br/> INFO 10:29:50,831 Completed
flushing<br/>/var/lib/cassandra/data/system/Migrations-h-2-Data.db (7546 bytes)<br/> INFO
10:29:50,832 Writing Memtable-Schema@421910828(3294/4117<br/>serialized/live bytes, 3
ops)<br/> INFO 10:29:50,846 Completed
flushing<br/>/var/lib/cassandra/data/system/Schema-h-2-Data.db (3444 bytes)<br/> INFO
10:29:50,854 Applying migration<br/>4b8c9fc0-1511-11e1-0000-c11bc95834d7 Add column
family:<br/>org.apache.cassandra.config.CFMetaData@1bd97d0d[cfId=1001,ksName=MSA,cfName=msgid,cfType=Standard,comparator=org.apache.cassandra.db.marshal.BytesType,subcolumncomparator=&lt;null&gt;,comment=,rowCacheSize=0.0,keyCacheSize=1000000.0,readRepairChance=1.0,replicateOnWrite=true,gcGraceSeconds=3600,defaultValidator=org.apache.cassandra.db.marshal.BytesType,keyValidator=org.apache.cassandra.db.marshal.BytesType,minCompactionThreshold=4,maxCompactionThreshold=32,rowCacheSavePeriodInSeconds=0,keyCacheSavePeriodInSeconds=14400,rowCacheKeysToSave=2147483647,rowCacheProvider=org.apache.cassandra.cache.SerializingCacheProvider@63a0eec3,mergeShardsChance=0.1,keyAlias=&lt;null&gt;,column_metadata={},compactionStrategyClass=class<br/>org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy,compactionStrategyOptions={},compressionOptions={}]<br/>
INFO 10:29:50,855 Enqueuing flush of<br/>Memtable-Migrations@1520138062(7750/9687
serialized/live bytes, 1 ops)<br/> INFO 10:29:50,856 Writing
Memtable-Migrations@1520138062(7750/9687<br/>serialized/live bytes, 1 ops)<br/> INFO
10:29:50,856 Enqueuing flush of<br/>Memtable-Schema@347459675(3630/4537 serialized/live
bytes, 3 ops)<br/> INFO 10:29:50,878 Completed
flushing<br/>/var/lib/cassandra/data/system/Migrations-h-3-Data.db (7814 bytes)<br/> INFO
10:29:50,879 Writing Memtable-Schema@347459675(3630/4537<br/>serialized/live bytes, 3
ops)<br/> INFO 10:29:50,894 Completed
flushing<br/>/var/lib/cassandra/data/system/Schema-h-3-Data.db (3780 bytes)<br/> INFO
10:29:50,900 Applying migration<br/>4ba1ae60-1511-11e1-0000-c11bc95834d7 Add column
family:<br/>org.apache.cassandra.config.CFMetaData@6a095b8a[cfId=1002,ksName=MSA,cfName=participants,cfType=Standard,comparator=org.apache.cassandra.db.marshal.ReversedType(org.apache.cassandra.db.marshal.BytesType),subcolumncomparator=&lt;null&gt;,comment=,rowCacheSize=0.0,keyCacheSize=1000000.0,readRepairChance=1.0,replicateOnWrite=true,gcGraceSeconds=3600,defaultValidator=org.apache.cassandra.db.marshal.BytesType,keyValidator=org.apache.cassandra.db.marshal.BytesType,minCompactionThreshold=4,maxCompactionThreshold=32,rowCacheSavePeriodInSeconds=0,keyCacheSavePeriodInSeconds=14400,rowCacheKeysToSave=2147483647,rowCacheProvider=org.apache.cassandra.cache.SerializingCacheProvider@c58f769,mergeShardsChance=0.1,keyAlias=&lt;null&gt;,column_metadata={},compactionStrategyClass=class<br/>org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy,compactionStrategyOptions={},compressionOptions={}]<br/>
INFO 10:29:50,900 Enqueuing flush of<br/>Memtable-Migrations@618337492(8194/10242
serialized/live bytes, 1 ops)<br/> INFO 10:29:50,901 Writing
Memtable-Migrations@618337492(8194/10242<br/>serialized/live bytes, 1 ops)<br/> INFO
10:29:50,902 Enqueuing flush of<br/>Memtable-Schema@724860211(4020/5025 serialized/live
bytes, 3 ops)<br/> INFO 10:29:50,917 Completed
flushing<br/>/var/lib/cassandra/data/system/Migrations-h-4-Data.db (8258 bytes)<br/> INFO
10:29:50,918 Writing Memtable-Schema@724860211(4020/5025<br/>serialized/live bytes, 3
ops)<br/> INFO 10:29:50,925
Compacting<br/>[SSTableReader(path='/var/lib/cassandra/data/system/Migrations-h-1-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Migrations-h-2-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Migrations-h-4-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Migrations-h-3-Data.db')]<br/>
INFO 10:29:50,934 Completed flushing<br/>/var/lib/cassandra/data/system/Schema-h-4-Data.db
(4170 bytes)<br/> INFO 10:29:50,935
Compacting<br/>[SSTableReader(path='/var/lib/cassandra/data/system/Schema-h-2-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Schema-h-1-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Schema-h-4-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Schema-h-3-Data.db')]<br/>
INFO 10:29:50,940 Applying migration<br/>4bb4e840-1511-11e1-0000-c11bc95834d7 Add column
family:<br/>org.apache.cassandra.config.CFMetaData@318c69a9[cfId=1003,ksName=MSA,cfName=subinfo,cfType=Standard,comparator=org.apache.cassandra.db.marshal.ReversedType(org.apache.cassandra.db.marshal.BytesType),subcolumncomparator=&lt;null&gt;,comment=,rowCacheSize=5000.0,keyCacheSize=5000000.0,readRepairChance=1.0,replicateOnWrite=true,gcGraceSeconds=3600,defaultValidator=org.apache.cassandra.db.marshal.BytesType,keyValidator=org.apache.cassandra.db.marshal.BytesType,minCompactionThreshold=4,maxCompactionThreshold=32,rowCacheSavePeriodInSeconds=14400,keyCacheSavePeriodInSeconds=14400,rowCacheKeysToSave=2147483647,rowCacheProvider=org.apache.cassandra.cache.SerializingCacheProvider@796cefa8,mergeShardsChance=0.1,keyAlias=&lt;null&gt;,column_metadata={},compactionStrategyClass=class<br/>org.apache.cassandra.db.compaction.LeveledCompactionStrategy,compactionStrategyOptions={sstable_size_in_mb=10}
,compressionOptions={}]<br/>
INFO 10:29:50,941 Enqueuing flush of<br/>Memtable-Migrations@1682081063(8618/10772
serialized/live bytes, 1<br/>ops)<br/> INFO 10:29:50,941 Writing
Memtable-Migrations@1682081063(8618/10772<br/>serialized/live bytes, 1 ops)<br/> INFO
10:29:50,941 Enqueuing flush of<br/>Memtable-Schema@1083461053(4427/5533 serialized/live
bytes, 3 ops)<br/> INFO 10:29:50,977 Completed
flushing<br/>/var/lib/cassandra/data/system/Migrations-h-5-Data.db (8682 bytes)<br/> INFO
10:29:50,978 Writing Memtable-Schema@1083461053(4427/5533<br/>serialized/live bytes, 3
ops)<br/> INFO 10:29:50,991 Compacted to<br/><span
class="error">&#91;/var/lib/cassandra/data/system/Schema-h-5-Data.db,&#93;</span>.  14,433
to<br/>14,106 (~97% of original) bytes for 5 keys at 0.269051MB/s.  Time:<br/>50ms.<br/>
INFO 10:29:50,995 Completed flushing<br/>/var/lib/cassandra/data/system/Schema-h-7-Data.db
(4577 bytes)<br/> INFO 10:29:51,000 Applying
migration<br/>4bc6e9a0-1511-11e1-0000-c11bc95834d7 Add column
family:<br/>org.apache.cassandra.config.CFMetaData@20b00ec2[cfId=1004,ksName=MSA,cfName=transactions,cfType=Standard,comparator=org.apache.cassandra.db.marshal.ReversedType(org.apache.cassandra.db.marshal.BytesType),subcolumncomparator=&lt;null&gt;,comment=,rowCacheSize=0.0,keyCacheSize=0.0,readRepairChance=1.0,replicateOnWrite=true,gcGraceSeconds=3600,defaultValidator=org.apache.cassandra.db.marshal.BytesType,keyValidator=org.apache.cassandra.db.marshal.BytesType,minCompactionThreshold=4,maxCompactionThreshold=32,rowCacheSavePeriodInSeconds=0,keyCacheSavePeriodInSeconds=0,rowCacheKeysToSave=2147483647,rowCacheProvider=org.apache.cassandra.cache.SerializingCacheProvider@698f352,mergeShardsChance=0.1,keyAlias=&lt;null&gt;,column_metadata={},compactionStrategyClass=class<br/>org.apache.cassandra.db.compaction.LeveledCompactionStrategy,compactionStrategyOptions=
{sstable_size_in_mb=10},compressionOptions={}]<br/>
INFO 10:29:51,001 Enqueuing flush of<br/>Memtable-Migrations@596545504(9027/11283
serialized/live bytes, 1 ops)<br/> INFO 10:29:51,002 Writing
Memtable-Migrations@596545504(9027/11283<br/>serialized/live bytes, 1 ops)<br/> INFO
10:29:51,003 Enqueuing flush of<br/>Memtable-Schema@1686621532(4835/6043 serialized/live
bytes, 3 ops)<br/> INFO 10:29:51,029 Completed
flushing<br/>/var/lib/cassandra/data/system/Migrations-h-7-Data.db (9091 bytes)<br/> INFO
10:29:51,029 Writing Memtable-Schema@1686621532(4835/6043<br/>serialized/live bytes, 3
ops)<br/> INFO 10:29:51,031 Compacted to<br/><span
class="error">&#91;/var/lib/cassandra/data/system/Migrations-h-6-Data.db,&#93;</span>. 
30,426 to<br/>30,234 (~99% of original) bytes for 1 keys at 0.272013MB/s. 
Time:<br/>106ms.<br/> INFO 10:29:51,044 Completed
flushing<br/>/var/lib/cassandra/data/system/Schema-h-8-Data.db (4985 bytes)<br/> INFO
10:29:51,049 Applying migration<br/>4bd76460-1511-11e1-0000-c11bc95834d7 Add column
family:<br/>org.apache.cassandra.config.CFMetaData@4ab4faeb[cfId=1005,ksName=MSA,cfName=uid,cfType=Standard,comparator=org.apache.cassandra.db.marshal.ReversedType(org.apache.cassandra.db.marshal.BytesType),subcolumncomparator=&lt;null&gt;,comment=,rowCacheSize=0.0,keyCacheSize=1500000.0,readRepairChance=1.0,replicateOnWrite=true,gcGraceSeconds=3600,defaultValidator=org.apache.cassandra.db.marshal.BytesType,keyValidator=org.apache.cassandra.db.marshal.BytesType,minCompactionThreshold=4,maxCompactionThreshold=32,rowCacheSavePeriodInSeconds=0,keyCacheSavePeriodInSeconds=14400,rowCacheKeysToSave=2147483647,rowCacheProvider=org.apache.cassandra.cache.SerializingCacheProvider@2fc5809e,mergeShardsChance=0.1,keyAlias=&lt;null&gt;,column_metadata={},compactionStrategyClass=class<br/>org.apache.cassandra.db.compaction.LeveledCompactionStrategy,compactionStrategyOptions={sstable_size_in_mb=10}
,compressionOptions={}]<br/>
INFO 10:29:51,050 Enqueuing flush of<br/>Memtable-Migrations@1333730706(9421/11776
serialized/live bytes, 1<br/>ops)<br/> INFO 10:29:51,050 Writing
Memtable-Migrations@1333730706(9421/11776<br/>serialized/live bytes, 1 ops)<br/> INFO
10:29:51,051 Enqueuing flush of<br/>Memtable-Schema@577668356(5236/6545 serialized/live
bytes, 3 ops)<br/> INFO 10:29:51,065 Completed
flushing<br/>/var/lib/cassandra/data/system/Migrations-h-9-Data.db (9485 bytes)<br/> INFO
10:29:51,066
Compacting<br/>[SSTableReader(path='/var/lib/cassandra/data/system/Migrations-h-6-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Migrations-h-9-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Migrations-h-7-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Migrations-h-5-Data.db')]<br/>
INFO 10:29:51,066 Writing Memtable-Schema@577668356(5236/6545<br/>serialized/live bytes, 3
ops)<br/> INFO 10:29:51,081 Completed
flushing<br/>/var/lib/cassandra/data/system/Schema-h-9-Data.db (5386 bytes)<br/> INFO
10:29:51,083
Compacting<br/>[SSTableReader(path='/var/lib/cassandra/data/system/Schema-h-5-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Schema-h-9-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Schema-h-8-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/Schema-h-7-Data.db')]<br/>
INFO 10:29:51,114 Compacted to<br/><span
class="error">&#91;/var/lib/cassandra/data/system/Schema-h-10-Data.db,&#93;</span>. 
29,054 to<br/>28,727 (~98% of original) bytes for 8 keys at 0.913207MB/s. 
Time:<br/>30ms.<br/> INFO 10:29:51,144 Compacted to<br/><span
class="error">&#91;/var/lib/cassandra/data/system/Migrations-h-10-Data.db,&#93;</span>. 
57,492 to<br/>57,300 (~99% of original) bytes for 1 keys at 0.700584MB/s. 
Time:<br/>78ms.<br/> INFO 10:29:51,410 Node /10.19.104.13 is now part of the cluster<br/>
INFO 10:29:51,412 InetAddress /10.19.104.13 is now UP<br/> INFO 10:29:51,414 Enqueuing
flush of<br/>Memtable-LocationInfo@709342045(35/43 serialized/live bytes, 1 ops)<br/> INFO
10:29:51,415 Writing Memtable-LocationInfo@709342045(35/43<br/>serialized/live bytes, 1
ops)<br/> INFO 10:29:51,428 Completed
flushing<br/>/var/lib/cassandra/data/system/LocationInfo-h-2-Data.db (89 bytes)<br/> INFO
10:29:51,439 Node /10.19.104.12 is now part of the cluster<br/> INFO 10:29:51,439
InetAddress /10.19.104.12 is now UP<br/> INFO 10:29:51,441 Enqueuing flush
of<br/>Memtable-LocationInfo@1292444743(35/43 serialized/live bytes, 1 ops)<br/> INFO
10:29:51,441 Writing Memtable-LocationInfo@1292444743(35/43<br/>serialized/live bytes, 1
ops)<br/> INFO 10:29:51,455 Completed
flushing<br/>/var/lib/cassandra/data/system/LocationInfo-h-3-Data.db (89 bytes)<br/> INFO
10:29:51,456 Node /10.19.104.11 is now part of the cluster<br/> INFO 10:29:51,457
InetAddress /10.19.104.11 is now UP<br/> INFO 10:29:51,459 Enqueuing flush
of<br/>Memtable-LocationInfo@1891328597(20/25 serialized/live bytes, 1 ops)<br/> INFO
10:29:51,459 Writing Memtable-LocationInfo@1891328597(20/25<br/>serialized/live bytes, 1
ops)<br/> INFO 10:29:51,471 Completed
flushing<br/>/var/lib/cassandra/data/system/LocationInfo-h-4-Data.db (74 bytes)<br/> INFO
10:29:51,473
Compacting<br/>[SSTableReader(path='/var/lib/cassandra/data/system/LocationInfo-h-2-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/LocationInfo-h-4-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/LocationInfo-h-1-Data.db'),<br/>SSTableReader(path='/var/lib/cassandra/data/system/LocationInfo-h-3-Data.db')]<br/>
INFO 10:29:51,497 Compacted to<br/><span
class="error">&#91;/var/lib/cassandra/data/system/LocationInfo-h-5-Data.db,&#93;</span>. 
552 to<br/>444 (~80% of original) bytes for 3 keys at 0.018410MB/s.  Time: 23ms.<br/> INFO
10:30:19,349 JOINING: getting bootstrap token<br/> INFO 10:30:19,352 Enqueuing flush
of<br/>Memtable-LocationInfo@225265367(36/45 serialized/live bytes, 1 ops)<br/> INFO
10:30:19,353 Writing Memtable-LocationInfo@225265367(36/45<br/>serialized/live bytes, 1
ops)<br/> INFO 10:30:19,364 Completed
flushing<br/>/var/lib/cassandra/data/system/LocationInfo-h-7-Data.db (87 bytes)<br/> INFO
10:30:19,374 JOINING: sleeping 30000 ms for pending range setup<br/> INFO 10:30:49,375
JOINING: Starting to bootstrap...<br/>ERROR 10:31:13,444 Fatal exception in thread
Thread<span
class="error">&#91;Thread-49,5,main&#93;</span><br/>java.lang.AssertionError<br/>       at
org.apache.cassandra.db.compaction.LeveledManifest.promote(LeveledManifest.java:178)<br/> 
     at
org.apache.cassandra.db.compaction.LeveledCompactionStrategy.handleNotification(LeveledCompactionStrategy.java:141)<br/>
      at
org.apache.cassandra.db.DataTracker.notifySSTablesChanged(DataTracker.java:466)<br/>      
at org.apache.cassandra.db.DataTracker.replace(DataTracker.java:275)<br/>       at
org.apache.cassandra.db.DataTracker.addSSTables(DataTracker.java:237)<br/>       at
org.apache.cassandra.db.DataTracker.addStreamedSSTable(DataTracker.java:242)<br/>       at
org.apache.cassandra.db.ColumnFamilyStore.addSSTable(ColumnFamilyStore.java:922)<br/>     
 at
org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:141)<br/>
      at
org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:102)<br/>
      at
org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:184)<br/>
      at
org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:81)
 

-----------------

-----------------
Comments: 

New Comment: 
I may have a similar, or the same problem.On a node where I was running repair (with no
other load), I am seeing these exceptions:ERROR <span
class="error">&#91;Thread-90&#93;</span> 2011-11-29 17:44:22,753
AbstractCassandraDaemon.java (line 133) Fatal exception in thread Thread<span
class="error">&#91;Thread-90,5,main&#93;</span><br/>java.lang.AssertionError<br/>       
at
org.apache.cassandra.db.compaction.LeveledManifest.promote(LeveledManifest.java:178)<br/> 
      at
org.apache.cassandra.db.compaction.LeveledCompactionStrategy.handleNotification(LeveledCompactionStrategy.java:141)<br/>
       at
org.apache.cassandra.db.DataTracker.notifySSTablesChanged(DataTracker.java:481)<br/>      
 at org.apache.cassandra.db.DataTracker.replace(DataTracker.java:275)<br/>        at
org.apache.cassandra.db.DataTracker.addSSTables(DataTracker.java:237)<br/>        at
org.apache.cassandra.db.DataTracker.addStreamedSSTable(DataTracker.java:242)<br/>       
at org.apache.cassandra.db.ColumnFamilyStore.addSSTable(ColumnFamilyStore.java:920)<br/>  
     at
org.apache.cassandra.streaming.StreamInSession.closeIfFinished(StreamInSession.java:141)<br/>
       at
org.apache.cassandra.streaming.IncomingStreamReader.read(IncomingStreamReader.java:103)<br/>
       at
org.apache.cassandra.net.IncomingTcpConnection.stream(IncomingTcpConnection.java:184)<br/>
       at
org.apache.cassandra.net.IncomingTcpConnection.run(IncomingTcpConnection.java:81) 


New Comment: 
LeveledManifest.promote only really knows how to handle compaction &#8211; swapping out
one set of sstables, for another.  When adding a new sstable, we need to call LM.add
instead.  Refactored DataTracker to do this correctly for streaming (and
load-new-sstables-from-jmx); in the process, got rid of addStreamedSSTable (becomes just
addSSTables(singletonlist) and added addInitialSSTables, to add to the tracker with no
notifications (since Strategy creation loads the manifest separately). 


New Comment: 
+1 


New Comment: 
Thanks Jonathan, the patch works for me. 


