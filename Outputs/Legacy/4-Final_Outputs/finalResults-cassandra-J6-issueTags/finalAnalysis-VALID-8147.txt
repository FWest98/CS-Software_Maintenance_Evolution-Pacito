Pattern changes caused by commit: 7322f8238bb53efbac2a078585c4582cb1fc5e4a

From: Abstract Factory-1
To:   Abstract Factory-2

From: Factory Method-1
To:   Factory Method-2


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-8147.txt 

commit 7322f8238bb53efbac2a078585c4582cb1fc5e4a
Author: Brandon Williams <brandonwilliams@apache.org>

    Load host_ids when adding saved endpoints
    Patch by brandonwilliams, reviewed by tjake for CASSANDRA-5032



==================================
 Issue CASSANDRA-5032 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-5032] Downed node loses its host-id
-----------------

-----------------
Summary: Downed node loses its host-id
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Wed, 5 Dec 2012 20:22:39 +0000
-----------------

-----------------
Resolved at: Thu, 6 Dec 2012 14:26:21 +0000
-----------------

-----------------
Assigned to: Brandon Williams
-----------------

-----------------
Description: 

We took down one of our nodes for maintenance and during that time it seems the other
nodes have lost the downed nodes node id

We also see lots of hint assertion exceptions
"Missing host ID for 10.6.27.98"
<div class="code panel" style="border-width: 1px;"><div
class="codeContent panelContent"><pre class="code-java">Status=Up/Down|/
State=Normal/Leaving/Joining/Moving--  Address           Load       Tokens  Owns
(effective)  Host ID                               RackUN  10.6.27.96        129.37 GB 
256     140.0%            59f3df94-e551-45ce-a3b0-51462f3ea868  27UN  10.6.27.97       
125.24 GB  256     133.7%            f5bb146c-db51-475c-a44f-9facf2f1ad6e  27DN 
10.6.27.98        ?          256     126.3%            <span
class="code-keyword">null</span>                                  27</pre></div></div>
We
restarted c* on the two other nodes that are up, my guess is the host id was lost on
restart of those.
 

-----------------

-----------------
Comments: 

New Comment: 
First patch renames 'ring_id' in peers to 'host_id' because that's what we call it
everywhere else including nodetool, so we should be consistent.Second patch updates the
hostid in TMD when it updates the tokens. 


New Comment: 
Looks straight fwd. I can test but this looks like I'll need to recreate the
cluster/system table? 


New Comment: 
I tested it and it works, but yeah, you'll have to wipe out the system table, or I think
starting once with -Dcassandra.load_ring=false will work. 


New Comment: 
+1 


