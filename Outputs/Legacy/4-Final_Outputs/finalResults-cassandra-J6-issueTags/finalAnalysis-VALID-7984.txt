Pattern changes caused by commit: 7cfdb14efb065cfb9a76a8ae3ec25d35f2fded15

From: Abstract Factory-1
To:   Abstract Factory-2

From: Factory Method-1
To:   Factory Method-2

From: Decorator-2
To:   Decorator-1

From: Facade-0
To:   Facade-1

From: Flyweight-2
To:   Flyweight-1

From: Mediator-3
To:   Mediator-1

From: Strategy-0
To:   Strategy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-7984.txt 

commit 7cfdb14efb065cfb9a76a8ae3ec25d35f2fded15
Author: Aleksey Yeschenko <aleksey@apache.org>

    cqlsh: improve COPY FROM performance; Patch by Aleksey Yeschenko,
    reviewed by Brandon Williams for CASSANDRA-4921



==================================
 Issue CASSANDRA-4921 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-4921] improve cqlsh COPY FROM performance
-----------------

-----------------
Summary: improve cqlsh COPY FROM performance
-----------------

-----------------
Issue type: Improvement
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Tue, 6 Nov 2012 17:55:36 +0000
-----------------

-----------------
Resolved at: Mon, 19 Nov 2012 19:17:27 +0000
-----------------

-----------------
Assigned to: Aleksey Yeschenko
-----------------

-----------------
Description: 

Profiling shows that prepare_inline takes the vast majority of cqlsh COPY FROM time,
particularly on csv rows with many columns.
 

-----------------

-----------------
Comments: 

New Comment: 
It looks like we can work around the regexp performance problems simply by omitting them
if params is empty (which it is since cqlsh does its own param substitution).To do this
cleanly we should update cqlsh in 1.1 to be compatible with python-cql master.However,
since 1.1 is unlikely to need further python-cql enhancements, creating a 1.1 branch with
the params fix is also fine. 


New Comment: 
Further testing shows that the version of python-cql in trunk does not have this regexp
performance problem.  But we still want to fix this for 1.1.7 as well. 


New Comment: 
I don't know what it was in recent cassandra-dbapi2 versions, but it seems like there is
no longer an issue.<br/>I'll do some more testing, but in half an hour of poking I found
no problems with 1.1 cqlsh + 1.4.0 python-cql combo. 


New Comment: 
I remember now. It's "CQL query must be bytes, not unicode" error when attempting COPY TO
and COPY FROM in CQL3 mode.<br/>Nothing else seems to be affected (DESCRIBE * commands
work fine and all field types are properly deserialized/formatted in both CQL2 and CQL3
mode). 


New Comment: 
Back ported cql_protect_name function from 1.2 (two line diff). Everything seems to be
working in both CQL2 and CQL3 modes. 


New Comment: 
For completeness: this is the cql-python commit that broke the compatibility: <a
href="https://code.google.com/a/apache-extras.org/p/cassandra-dbapi2/source/detail?r=620f813baae3b568349d3fc8886f9e29280f3164"
class="external-link"
rel="nofollow">https://code.google.com/a/apache-extras.org/p/cassandra-dbapi2/source/detail?r=620f813baae3b568349d3fc8886f9e29280f3164</a>
(resolving this issue: <a
href="https://code.google.com/a/apache-extras.org/p/cassandra-dbapi2/issues/detail?id=19"
class="external-link"
rel="nofollow">https://code.google.com/a/apache-extras.org/p/cassandra-dbapi2/issues/detail?id=19</a>). 


New Comment: 
+1 


