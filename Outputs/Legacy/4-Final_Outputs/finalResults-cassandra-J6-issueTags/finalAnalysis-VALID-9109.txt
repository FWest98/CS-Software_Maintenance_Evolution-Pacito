Pattern changes caused by commit: a25ac14e0d245f648e97f888ee4b64acc50c76d1

From: Abstract Factory-2
To:   Abstract Factory-1

From: Factory Method-2
To:   Factory Method-1

From: Decorator-1
To:   Decorator-2

From: Facade-1
To:   Facade-0

From: Flyweight-1
To:   Flyweight-2

From: Mediator-1
To:   Mediator-3

From: Strategy-1
To:   Strategy-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-9109.txt 

commit a25ac14e0d245f648e97f888ee4b64acc50c76d1
Author: Dave Brosius <dbrosius@apache.org>

    switch shuffle's insert of a token to using new blob syntax
    patch by dbrosius reviewed by ayeschenko for CASSANDRA-5465



==================================
 Issue CASSANDRA-5465 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-5465] Shuffle fails to write to system.range_xfers
-----------------

-----------------
Summary: Shuffle fails to write to system.range_xfers
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Sat, 13 Apr 2013 07:46:31 +0000
-----------------

-----------------
Resolved at: Sat, 13 Apr 2013 21:27:34 +0000
-----------------

-----------------
Assigned to: Unassigned
-----------------

-----------------
Description: 

On trunk, only, executing

INSERT INTO system.range_xfers (token_bytes, requested_at)
VALUES ('5e29cbe30503a9ec', 'now');

fails with

Exception in thread "main"
java.lang.RuntimeException: InvalidRequestException(why:Invalid STRING constant
(5e29cbe30503a9ec) for token_bytes of type blob)<br/>	at
org.apache.cassandra.tools.Shuffle.executeCqlQuery(Shuffle.java:516)<br/>	at
org.apache.cassandra.tools.Shuffle.shuffle(Shuffle.java:359)<br/>	at
org.apache.cassandra.tools.Shuffle.main(Shuffle.java:681)

patch validates
blob-&gt;string
 

-----------------

-----------------
Comments: 

New Comment: 
This fix is wrong. BLOB is not there for a reason, and the reason is that in 2.0 'cafe'
syntax for blobs is no longer valid. You should fix shuffle instead to use 0xcafe syntax
(and do that against 1.2 as well, to avoid the deprecation warning in Cassandra logs). 


New Comment: 
So we're introducing a breaking (non-backward compatible) change? 


New Comment: 
It was introduced back in 1.2.2. In 1.2 both versions will continue to coexist, so you are
able to upgrade. See <a href="https://issues.apache.org/jira/browse/CASSANDRA-5198"
title="Fix CQL3 loose type validation of constants" class="issue-link"
data-issue-key="CASSANDRA-5198"><del>CASSANDRA-5198</del></a> and Jake's comment - <a
href="https://issues.apache.org/jira/browse/CASSANDRA-5198?focusedCommentId=13569019&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13569019"
class="external-link"
rel="nofollow">https://issues.apache.org/jira/browse/CASSANDRA-5198?focusedCommentId=13569019&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13569019</a>. 


New Comment: 
So we introduced a breaking change. 


New Comment: 
So Aleksey, i take it you are saying that Shuffle needs to use prepared statements so that
the token can be sent as a ByteBuffer (byte[]) ? 


New Comment: 
<blockquote>So we introduced a breaking change.</blockquote>My understanding is that we
did not: the old format continues to work.  What we did do was allow a new format that
previously would have errored, and deprecated blob-strings for removal in 2.0. 


New Comment: 
oh i see, remove ' 's, and add 0x... donepatch on 1.2 &#8211; 5465_2.txt 


New Comment: 
<blockquote>My understanding is that we did not: the old format continues to work. What we
did do was allow a new format that previously would have errored, and deprecated
blob-strings for removal in 2.0.</blockquote>Right, that's what I meant, we introduced a
breaking change, 1.2 -&gt; 2.0.  CQL 4, then? 


New Comment: 
+1 


