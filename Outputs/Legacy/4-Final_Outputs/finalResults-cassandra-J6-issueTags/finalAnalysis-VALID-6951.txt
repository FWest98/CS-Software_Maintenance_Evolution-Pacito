Pattern changes caused by commit: 6352edb3fe0a3a678e83ba11002e4cdde2cac468

From: Decorator-2
To:   Decorator-1

From: Flyweight-2
To:   Flyweight-1

From: Mediator-3
To:   Mediator-1

From: Strategy-0
To:   Strategy-1

From: Template Method-3
To:   Template Method-2


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-6951.txt 

commit 6352edb3fe0a3a678e83ba11002e4cdde2cac468
Author: Jonathan Ellis <jbellis@apache.org>

    fix NPE in compactionstats
    patch by jbellis; reviewed by xedin for CASSANDRA-4318



==================================
 Issue CASSANDRA-4318 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-4318] Nodetool compactionstats fails with NullPointerException
-----------------

-----------------
Summary: Nodetool compactionstats fails with NullPointerException
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Thu, 7 Jun 2012 22:25:03 +0000
-----------------

-----------------
Resolved at: Sat, 9 Jun 2012 15:37:45 +0000
-----------------

-----------------
Assigned to: Jonathan Ellis
-----------------

-----------------
Description: 

Test uses Column family C defined as follows:

create column family C with caching =
'keys_only' and key_validation_class = 'LongType' and compression_options = 
{
sstable_compression: SnappyCompressor, chunk_length_kb: 64 }
 and
max_compaction_threshold=0; 

max_compaction_threshold is set to 0 to disable auto
compaction.

SSTables are streamed via sstableloader, after which a major compaction is
triggered using "nodetool compact MyKeyspace C".

Thereafter, attempts to request
compaction stats via "nodetool compactionstats" fail with the following
exception:

Exception in thread "main" java.lang.NullPointerException<br/>        at
org.apache.cassandra.db.compaction.CompactionInfo.asMap(CompactionInfo.java:103)<br/>     
  at
org.apache.cassandra.db.compaction.CompactionManager.getCompactions(CompactionManager.java:1115)<br/>
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br/>        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)<br/>       
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br/>
       at java.lang.reflect.Method.invoke(Method.java:597)<br/>        at
com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:93)<br/>
       at
com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:27)<br/>
       at
com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:208)<br/>       
at com.sun.jmx.mbeanserver.PerInterface.getAttribute(PerInterface.java:65)<br/>        at
com.sun.jmx.mbeanserver.MBeanSupport.getAttribute(MBeanSupport.java:216)<br/>        at
com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:666)<br/>
       at
com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:638)<br/>       
at
javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1404)<br/>
       at
javax.management.remote.rmi.RMIConnectionImpl.access$200(RMIConnectionImpl.java:72)<br/>  
     at
javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1265)<br/>
       at
javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1360)<br/>
       at
javax.management.remote.rmi.RMIConnectionImpl.getAttribute(RMIConnectionImpl.java:600)<br/>
       at sun.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)<br/>        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br/>
       at java.lang.reflect.Method.invoke(Method.java:597)<br/>        at
sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:303)<br/>        at
sun.rmi.transport.Transport$1.run(Transport.java:159)<br/>        at
java.security.AccessController.doPrivileged(Native Method)<br/>        at
sun.rmi.transport.Transport.serviceCall(Transport.java:155)<br/>        at
sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:535)<br/>        at
sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:790)<br/>     
  at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:649)<br/> 
      at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)<br/>  
     at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)<br/>      
 at java.lang.Thread.run(Thread.java:662) 
 

-----------------

-----------------
Comments: 

New Comment: 
patch attached to deal with cfm directly instead of looking up by id, and create a dummy
cfm for cache saving instead of leaving null 


New Comment: 
+1 


