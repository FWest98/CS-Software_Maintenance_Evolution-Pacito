Pattern changes caused by commit: 3f6c50a1d161c189329e6801a2ac006a47d5acda

From: Decorator-1
To:   Decorator-0

From: Flyweight-4
To:   Flyweight-5

From: Strategy-1
To:   Strategy-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-5415.txt 

commit 3f6c50a1d161c189329e6801a2ac006a47d5acda
Author: T Jake Luciani <jake@apache.org>

    Revert CASSANDRA-3450



==================================
 Issue CASSANDRA-3450 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3450] maybeInit in ColumnFamilyRecordReader can cause rows to be empty but not null
-----------------

-----------------
Summary: maybeInit in ColumnFamilyRecordReader can cause rows to be empty but not null
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Thu, 3 Nov 2011 17:20:51 +0000
-----------------

-----------------
Resolved at: Fri, 4 Nov 2011 21:29:00 +0000
-----------------

-----------------
Assigned to: Lanny Ripple
-----------------

-----------------
Description: 

1) In <tt>ColumnFamilyRecordReader</tt> <tt>isPredicateEmpty</tt> needs bracing to
correctly place the <tt>else if</tt> to the properly controlling <tt>if</tt>.

1a)
<tt>isPredicateEmpty</tt> should use an || in the getSlice_range predicate rather than
&amp;&amp;.

2) In <tt>ColumnFamilyRecordReader</tt> <tt>computeNext()</tt> calls
<tt>maybeInit()</tt> and then if <tt>ros</tt> is not null it is indexed into. 
<tt>maybeInit()</tt> could fetch new data, determine the associated slice predicate is
empty, and end up removing all the rows if all columns turned out to be empty.  There is
no check for <tt>rows.isEmpty()</tt> after the possible removal of all rows.
 

-----------------

-----------------
Comments: 

New Comment: 
Committed, thanks! 


New Comment: 
Integrated in Cassandra-0.8 #393 (See <a
href="https://builds.apache.org/job/Cassandra-0.8/393/" class="external-link"
rel="nofollow">https://builds.apache.org/job/Cassandra-0.8/393/</a>)<br/>    Fix empty row
filtering and check if there are no rows returned.<br/>Patch by Lanny Ripple, reviewed by
brandonwilliams for <a href="https://issues.apache.org/jira/browse/CASSANDRA-3450"
title="maybeInit in ColumnFamilyRecordReader can cause rows to be empty but not null"
class="issue-link"
data-issue-key="CASSANDRA-3450"><del>CASSANDRA-3450</del></a>brandonwilliams : <a
href="http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1197786"
class="external-link"
rel="nofollow">http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;view=rev&amp;rev=1197786</a><br/>Files
:
<ul>	<li>/cassandra/branches/cassandra-0.8/CHANGES.txt</li>	<li>/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/hadoop/ColumnFamilyRecordReader.java</li></ul> 


New Comment: 
Reverted this change due to a bug related to single node test failures.  Going to attempt
a fresh fix at this and <a href="https://issues.apache.org/jira/browse/CASSANDRA-2855"
title="Skip rows with empty columns when slicing entire row" class="issue-link"
data-issue-key="CASSANDRA-2855"><del>CASSANDRA-2855</del></a> 


