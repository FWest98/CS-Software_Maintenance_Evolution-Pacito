Pattern changes caused by commit: 1f7ff16210dbdb96ac387341bdf3350e52c3208b

From: Decorator-1
To:   Decorator-0

From: Flyweight-4
To:   Flyweight-5

From: Strategy-1
To:   Strategy-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-4922.txt 

commit 1f7ff16210dbdb96ac387341bdf3350e52c3208b
Author: Jonathan Ellis <jbellis@apache.org>

    Avoid streaming data to nodes that already have it, on move as well as decommission
    patch by Nick Bailey and jbellis for CASSANDRA-3041



==================================
 Issue CASSANDRA-3041 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3041] Move streams data to too many nodes.
-----------------

-----------------
Summary: Move streams data to too many nodes.
-----------------

-----------------
Issue type: Improvement
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Tue, 16 Aug 2011 19:28:04 +0000
-----------------

-----------------
Resolved at: Tue, 13 Sep 2011 19:22:35 +0000
-----------------

-----------------
Assigned to: Nick Bailey
-----------------

-----------------
Description: 

When you decommission a node, it only streams data to the node that is just now gaining
responsibility for the node's primary range.

When you move a node it streams data to
every node that is responsible for the node's primary range. This is way more than it
needs to, and could be bad in multi-dc setups. We should absolutely use this bug as a
chance/reason to better unify that code, since move should be doing the same thing decom
does.

This might be worth backporting to 0.8 as well.
 

-----------------

-----------------
Comments: 

New Comment: 
Marking this for the next 0.8.x version since the data duplication caused by this bug is
data that does actually belong on the nodes, so it can't be removed by cleanup. It either
has to be unduplicated with a major compaction or rely on regular compaction. 


New Comment: 
Simplest change to fix this. I still think we should refactor a lot of that code, but
perhaps not in 0.8.If I have time to figure out a good approach for combining code I'll
attach a patch. 


New Comment: 
v2 uses Sets.difference instead of removeAll 


New Comment: 
From IRC:<blockquote>nickmbailey: new patch looks fine, the news.txt update should say
move/decomm though</blockquote> 


New Comment: 
committed 


