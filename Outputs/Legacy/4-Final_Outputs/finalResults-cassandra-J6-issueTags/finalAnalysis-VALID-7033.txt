Pattern changes caused by commit: 98dc41393fc6cc2b2b8756f6d8b33f86c45c0726

From: Decorator-2
To:   Decorator-1

From: Flyweight-2
To:   Flyweight-1

From: Mediator-3
To:   Mediator-1

From: Strategy-0
To:   Strategy-1

From: Template Method-3
To:   Template Method-2


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-7033.txt 

commit 98dc41393fc6cc2b2b8756f6d8b33f86c45c0726
Author: Jonathan Ellis <jbellis@apache.org>

    Check schema before trying to export sstable
    patch by Jason Brown; reviewed by jbellis for CASSANDRA-2760



==================================
 Issue CASSANDRA-2760 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-2760] NPE in sstable2json
-----------------

-----------------
Summary: NPE in sstable2json
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Fri, 10 Jun 2011 17:48:43 +0000
-----------------

-----------------
Resolved at: Wed, 27 Jun 2012 00:53:39 +0000
-----------------

-----------------
Assigned to: Jason Brown
-----------------

-----------------
Description: 

./sstable2json /var/lib/cassandra/data/test/snapshots/1307649033076/User-g-4-Data.db
<br/>{<br/>Exception in thread "main" java.lang.NullPointerException<br/>        at
org.apache.cassandra.db.ColumnFamily.&lt;init&gt;(ColumnFamily.java:82)<br/>        at
org.apache.cassandra.db.ColumnFamily.create(ColumnFamily.java:70)<br/>        at
org.apache.cassandra.io.sstable.SSTableIdentityIterator.&lt;init&gt;(SSTableIdentityIterator.java:142)<br/>
       at
org.apache.cassandra.io.sstable.SSTableIdentityIterator.&lt;init&gt;(SSTableIdentityIterator.java:90)<br/>
       at
org.apache.cassandra.io.sstable.SSTableIdentityIterator.&lt;init&gt;(SSTableIdentityIterator.java:74)<br/>
       at
org.apache.cassandra.io.sstable.SSTableScanner$KeyScanningIterator.next(SSTableScanner.java:179)<br/>
       at
org.apache.cassandra.io.sstable.SSTableScanner$KeyScanningIterator.next(SSTableScanner.java:144)<br/>
       at
org.apache.cassandra.io.sstable.SSTableScanner.next(SSTableScanner.java:136)<br/>       
at org.apache.cassandra.tools.SSTableExport.export(SSTableExport.java:313)<br/>        at
org.apache.cassandra.tools.SSTableExport.export(SSTableExport.java:344)<br/>        at
org.apache.cassandra.tools.SSTableExport.export(SSTableExport.java:357)<br/>        at
org.apache.cassandra.tools.SSTableExport.main(SSTableExport.java:415)
 

-----------------

-----------------
Comments: 

New Comment: 
Sounds like you're trying to run sstable2json on a columnfamily that isn't present in your
schema. 


New Comment: 
Instead of trying to process an unknown column family (and exiting with an exception),
load the Descriptor at the top of the export process and check to see if the
keyspace/column family exists inside the current cassandra setup. If not, print a warning
message and exit. 


New Comment: 
Note: I worked on this patch against the current (1.2) trunk. I can backport it to earlier
versions, if we need. 


