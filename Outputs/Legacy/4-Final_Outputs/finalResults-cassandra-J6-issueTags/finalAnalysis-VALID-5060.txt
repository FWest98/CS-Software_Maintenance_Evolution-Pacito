Pattern changes caused by commit: 2cd49b5e6a7a6bd86873a4512a5cf61068f15049

From: Decorator-1
To:   Decorator-0

From: Flyweight-4
To:   Flyweight-5

From: Strategy-1
To:   Strategy-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-5060.txt 

commit 2cd49b5e6a7a6bd86873a4512a5cf61068f15049
Author: Brandon Williams <brandonwilliams@apache.org>

    Fix FD leak when internode encryption is enabled.
    Patch by Vijay, reviewed by brandonwilliams for CASSANDRA-3257



==================================
 Issue CASSANDRA-3257 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3257] Enabling SSL on a fairly light cluster leaks Open files.
-----------------

-----------------
Summary: Enabling SSL on a fairly light cluster leaks Open files.
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Sun, 25 Sep 2011 17:25:44 +0000
-----------------

-----------------
Resolved at: Mon, 26 Sep 2011 17:14:24 +0000
-----------------

-----------------
Assigned to: Vijay
-----------------

-----------------
Description: 

To reproduce:

Enable SSL encryption and let the server be idle for a day or so you will
see the below....

<span class="error">&#91;vijay_tcasstest@vijay_tcass--1c-i-1568885c
~&#93;</span>$ /usr/sbin/lsof |grep -i cassandra-app.jks |wc -l ;date<br/>16333<br/>Sun
Sep 25 17:23:29 UTC 2011<br/><span
class="error">&#91;vijay_tcasstest@vijay_tcass--1c-i-1568885c ~&#93;</span>$ java -jar
cmdline-jmxclient-0.10.3.jar - localhost:7501 java.lang:type=Memory gc<br/><span
class="error">&#91;vijay_tcasstest@vijay_tcass--1c-i-1568885c ~&#93;</span>$
/usr/sbin/lsof |grep -i cassandra-app.jks |wc -l ;date<br/>64<br/>Sun Sep 25 17:23:53 UTC
2011<br/><span class="error">&#91;vijay_tcasstest@vijay_tcass--1c-i-1568885c
~&#93;</span>$ 

After running GC manually the issue goes away.
 

-----------------

-----------------
Comments: 

New Comment: 
This issue elevates when a node is down. 


New Comment: 
Seems like the issue may be because we are opening the FIS and not closing it.... in
SSLFactory.createSSLContext, testing it... patch soon. 


New Comment: 
Closing the FIS fixes the issue (in SSLFactory). 


New Comment: 
Committed, thanks! 


New Comment: 
should use FileUtils.closeQuietly so if one close throws, the other still happens 


New Comment: 
done in r1176204.  also cleaned up formatting. 


