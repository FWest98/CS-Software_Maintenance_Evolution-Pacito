Pattern changes caused by commit: af9b730398463658ab4cfe41daa8ab0f98548627

From: Mediator-0
To:   Mediator-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-345.txt 

commit af9b730398463658ab4cfe41daa8ab0f98548627
Author: Hairong Kuang <hairong@apache.org>

    HDFS-564. Adding pipeline tests 17-35. Contributed by Nicholas, Kan, and Hairong.



==================================
 Issue HDFS-564 Description 
=======================================

Project: Hadoop HDFS
-----------------

-----------------
Title: [HDFS-564] Adding pipeline test 17-35
-----------------

-----------------
Summary: Adding pipeline test 17-35
-----------------

-----------------
Issue type: Sub-task
-----------------

-----------------
Current status: Closed
-----------------

-----------------
Created at: Tue, 25 Aug 2009 00:29:01 +0000
-----------------

-----------------
Resolved at: Tue, 22 Dec 2009 04:45:07 +0000
-----------------

-----------------
Assigned to: Hairong Kuang
-----------------

-----------------
Description: 
 

-----------------

-----------------
Comments: 

New Comment: 
I've attached 2 preliminary patches. h564-24.patch is a patch for the pre-append-merge
trunk. This patch changes the behavior of BlockReciever.java in 2 ways. 1) When downstream
error happens (ends up in handleMirrorOutError()), the receiver thread no longer
interrupts the responder thread, which may lead the responder to behave as if local error
has occurred and give the wrong idea to upstream node. 2) The responder will try to read
all downstream statuses (up to first ERROR status) before sending its own status and
forwarding others to upstream node. If the responder fails to read all downstream statuses
it needs, it will mark the next downstream datanode as ERROR.h564-24.patch implements all
the tests except 26-28 and 31-33. In the case of test 26-28, I've seen intermittent
failures similar to those described in <a
href="https://issues.apache.org/jira/browse/HDFS-101" title="DFS write pipeline :
DFSClient sometimes does not detect second datanode failure " class="issue-link"
data-issue-key="HDFS-101"><del>HDFS-101</del></a>, i.e., when the first datanode sends all
statuses to DFSClient and closes the socket, DFSClient isn't able to read those statuses
and instead gets a TCP reset. As a result, DFSClient will mistakenly consider the first
datanode at fault. In the case of test 31-33, the DFSClient will keep receiving  seqno ==
-1 (keep alive) and hang.h564-25.patch is a quick port of h564-24.patch to the current
post-append-merge trunk. Unfortunately many of the tests are failing and I may not have
time to investigate it. Hopefully, someone can pick it up from here. 


New Comment: 
This patch merges Kan's patch with the trunk, with some slight changes. It also contains
the patch to <a href="https://issues.apache.org/jira/browse/HDFS-101" title="DFS write
pipeline : DFSClient sometimes does not detect second datanode failure "
class="issue-link" data-issue-key="HDFS-101"><del>HDFS-101</del></a>. With the fix to <a
href="https://issues.apache.org/jira/browse/HDFS-101" title="DFS write pipeline :
DFSClient sometimes does not detect second datanode failure " class="issue-link"
data-issue-key="HDFS-101"><del>HDFS-101</del></a>, all unit tests pass. The only problem
is that the new tests run for too long time. I will try to improve their speed later. 


New Comment: 
+1 patch looks good.I've ran fault injection tests and they are passing except that I see
an intermittent failure in TestFiHFlush. However, it the failures are happening in the
tests which do not expect to find a pipeline when <tt>hflush()</tt> is called after a
write within block boundaries. I think these three tests (hFlushFi01_a, hFlushFi02_a,
hFlushFi03_a) need to be revisited. 


New Comment: 
Here is a patch that excludes fix to <a
href="https://issues.apache.org/jira/browse/HDFS-101" title="DFS write pipeline :
DFSClient sometimes does not detect second datanode failure " class="issue-link"
data-issue-key="HDFS-101"><del>HDFS-101</del></a>. 


New Comment: 
Test 17-35 are not found in pipelineTests1.patch.  Forgot to add them? 


New Comment: 
+1 overall.  Here are the results of testing the latest attachment <br/>  <a
href="http://issues.apache.org/jira/secure/attachment/12428501/pipelineTests1.patch"
class="external-link"
rel="nofollow">http://issues.apache.org/jira/secure/attachment/12428501/pipelineTests1.patch</a><br/>
 against trunk revision 892941.    +1 @author.  The patch does not contain any @author
tags.    +1 tests included.  The patch appears to include 24 new or modified tests.    +1
javadoc.  The javadoc tool did not generate any warning messages.    +1 javac.  The
applied patch does not increase the total number of javac compiler warnings.    +1
findbugs.  The patch does not introduce any new Findbugs warnings.    +1 release audit. 
The applied patch does not increase the total number of release audit warnings.    +1 core
tests.  The patch passed core unit tests.    +1 contrib tests.  The patch passed contrib
unit tests.Test results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/154/testReport/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/154/testReport/</a><br/>Findbugs
warnings: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/154/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/154/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html</a><br/>Checkstyle
results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/154/artifact/trunk/build/test/checkstyle-errors.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/154/artifact/trunk/build/test/checkstyle-errors.html</a><br/>Console
output: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/154/console"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/154/console</a>This
message is automatically generated. 


New Comment: 
This patch includes the new tests and they all passed. 


New Comment: 
-1 overall.  Here are the results of testing the latest attachment <br/>  <a
href="http://issues.apache.org/jira/secure/attachment/12428669/pipelineTests2.patch"
class="external-link"
rel="nofollow">http://issues.apache.org/jira/secure/attachment/12428669/pipelineTests2.patch</a><br/>
 against trunk revision 893039.    +1 @author.  The patch does not contain any @author
tags.    +1 tests included.  The patch appears to include 27 new or modified tests.    +1
javadoc.  The javadoc tool did not generate any warning messages.    +1 javac.  The
applied patch does not increase the total number of javac compiler warnings.    +1
findbugs.  The patch does not introduce any new Findbugs warnings.    +1 release audit. 
The applied patch does not increase the total number of release audit warnings.    -1 core
tests.  The patch failed core unit tests.    +1 contrib tests.  The patch passed contrib
unit tests.Test results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/87/testReport/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/87/testReport/</a><br/>Findbugs
warnings: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/87/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/87/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html</a><br/>Checkstyle
results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/87/artifact/trunk/build/test/checkstyle-errors.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/87/artifact/trunk/build/test/checkstyle-errors.html</a><br/>Console
output: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/87/console"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/87/console</a>This
message is automatically generated. 


New Comment: 
The failed core test is not caused by this patch because this patch adds only fault
injection tests. 


New Comment: 
I've committed this. Thanks, Nicholas and Kan! 


New Comment: 
Integrated in Hadoop-Hdfs-trunk-Commit #154 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/154/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/154/</a>)<br/>
   . Adding pipeline tests 17-35. Contributed by Nicholas, Kan, and Hairong. 


New Comment: 
Integrated in Hdfs-Patch-h5.grid.sp2.yahoo.net #159 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/159/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/159/</a>) 


New Comment: 
Integrated in Hadoop-Hdfs-trunk #182 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk/182/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk/182/</a>) 


