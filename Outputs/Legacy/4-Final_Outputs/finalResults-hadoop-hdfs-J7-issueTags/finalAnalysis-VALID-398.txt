Pattern changes caused by commit: 12bbab73fa246efd22a316845743094023b23b30

From: Mediator-0
To:   Mediator-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-398.txt 

commit 12bbab73fa246efd22a316845743094023b23b30
Author: Konstantin Shvachko <shv@apache.org>

    HDFS-984. Persistent delegation tokens. Contributed by Jitendra Pandey.



==================================
 Issue HDFS-984 Description 
=======================================

Project: Hadoop HDFS
-----------------

-----------------
Title: [HDFS-984] Delegation Tokens should be persisted in Namenode
-----------------

-----------------
Summary: Delegation Tokens should be persisted in Namenode
-----------------

-----------------
Issue type: New Feature
-----------------

-----------------
Current status: Closed
-----------------

-----------------
Created at: Thu, 18 Feb 2010 00:41:16 +0000
-----------------

-----------------
Resolved at: Fri, 26 Feb 2010 02:08:20 +0000
-----------------

-----------------
Assigned to: Jitendra Nath Pandey
-----------------

-----------------
Description: 

The Delegation tokens should be persisted in the FsImage and EditLogs so that they are
valid to be used after namenode shutdown and restart.
 

-----------------

-----------------
Comments: 

New Comment: 
Can you please explain the use-case why these need to be persisted? 


New Comment: 
This patch is dependent on <a href="https://issues.apache.org/jira/browse/HADOOP-6573"
title="Delegation Tokens should be persisted." class="issue-link"
data-issue-key="HADOOP-6573"><del>HADOOP-6573</del></a> patch to compile successfully. 


New Comment: 
&gt; Can you please explain the use-case why these need to be persisted?<br/>  Delegation
tokens are used by tasks to authenticate with namenode. If namenode restarts and looses
information for previously issued delegation tokens, the running tasks will not be able to
connect to the namenode.<br/>  The scope of this jira is limited to delegation tokens
issued by namenode. The delgation tokens in MR issued by JT are not being persisted. 


New Comment: 
Including comments for both issue this one and <a
href="https://issues.apache.org/jira/browse/HADOOP-6573" title="Delegation Tokens should
be persisted." class="issue-link"
data-issue-key="HADOOP-6573"><del>HADOOP-6573</del></a>.<ol>	<li>Interchanging names
logGetDelegationToken() and logAddDelegationToken() are confusing - should be consistent
either all Get or all Add. Should OP_GET_DELEGATION_TOKEN be
OP_ADD_DELEGATION_TOKEN?</li>	<li>Reuse the instance of DelegationTokenIdentifier in
loadFSEdits()</li>	<li>loadFSEdits() should log new token ops in debug mode.</li>	<li>I
think we should throw an exception if the same token is added (not renewed)
twice.</li>	<li>AbstractDelegationTokenSecretManager uses 2 locks (this and currentTokens)
- probably an attempt to do a read/write lock. You don't use them consistently.<br/>
currentTokens.get() returns a reference to the value, not a copy. So when you access the
value fields outside the lock they may be changing by other threads. It would be better to
have just one lock (this).</li>	<li>No need to make isInSafeMode() public.</li>	<li>Import
warnings in FSNamesystem, DelegationTokenSecretManager</li>	<li>@Override // &lt;which
class it overrides&gt;</li>	<li>public methods and classes must have JavaDoc.</li></ol> 


New Comment: 
New patch addressing the review comments. 


New Comment: 
<ul class="alternate" type="square">	<li>AbstractDelegationTokenSecretManager.renewToken()
should be synchronized</li>	<li>Same with cancelToken()</li>	<li>imports in
DelegationTokenSecretManager and Tests</li></ul>+1 other than that. 


New Comment: 
New patch addressing the comments 


New Comment: 
test patch results-     <span class="error">&#91;exec&#93;</span> +1 overall.<br/>    
<span class="error">&#91;exec&#93;</span><br/>     <span
class="error">&#91;exec&#93;</span>     +1 @author.  The patch does not contain any
@author tags.<br/>     <span class="error">&#91;exec&#93;</span><br/>     <span
class="error">&#91;exec&#93;</span>     +1 tests included.  The patch appears to include
15 new or modified tests.<br/>     <span class="error">&#91;exec&#93;</span><br/>    
<span class="error">&#91;exec&#93;</span>     +1 javadoc.  The javadoc tool did not
generate any warning messages.<br/>     <span class="error">&#91;exec&#93;</span><br/>    
<span class="error">&#91;exec&#93;</span>     +1 javac.  The applied patch does not
increase the total number of javac compiler warnings.<br/>     <span
class="error">&#91;exec&#93;</span><br/>     <span class="error">&#91;exec&#93;</span>    
+1 findbugs.  The patch does not introduce any new Findbugs warnings.<br/>     <span
class="error">&#91;exec&#93;</span><br/>     <span class="error">&#91;exec&#93;</span>    
+1 release audit.  The applied patch does not increase the total number of release audit
warnings. 


New Comment: 
ant run-test-hdfs ran successfully. 


New Comment: 
Please run ant test-core. run-test-hdfs target does not cover some tests like fi tests. 


New Comment: 
Other tests also run fine. 


New Comment: 
I just committed this. Thank you Jitendra. 


New Comment: 
Integrated in Hadoop-Hdfs-trunk-Commit #204 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/204/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/204/</a>)<br/>
   . Persistent delegation tokens. Contributed by Jitendra Pandey. 


New Comment: 
20 patch uploaded.<br/>Combines <a
href="https://issues.apache.org/jira/browse/HADOOP-6573" title="Delegation Tokens should
be persisted." class="issue-link" data-issue-key="HADOOP-6573"><del>HADOOP-6573</del></a>
and MR-1537 too. 


New Comment: 
Integrated in Hadoop-Mapreduce-trunk-Commit #252 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hadoop-Mapreduce-trunk-Commit/252/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hadoop-Mapreduce-trunk-Commit/252/</a>) 


New Comment: 
Integrated in Hdfs-Patch-h2.grid.sp2.yahoo.net #146 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/146/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/146/</a>) 


New Comment: 
Integrated in Hdfs-Patch-h5.grid.sp2.yahoo.net #302 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/302/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/302/</a>) 


