Pattern changes caused by commit: 89734ea88700b181551be5c77de90ee95a016144

From: Facade-4
To:   Facade-2

From: Proxy-0
To:   Proxy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-1434.txt 

commit 89734ea88700b181551be5c77de90ee95a016144
Author: Julien Vermillard <jvermillard@apache.org>

    Applying Geoff Cadien patch for fixing destruction of APR sockets. See DIRMINA-584



==================================
 Issue DIRMINA-584 Description 
=======================================

Project: MINA
-----------------

-----------------
Title: [DIRMINA-584] Using apr-transport crashes jvm on Linux
-----------------

-----------------
Summary: Using apr-transport crashes jvm on Linux
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Closed
-----------------

-----------------
Created at: Wed, 14 May 2008 00:35:15 +0000
-----------------

-----------------
Resolved at: Fri, 6 Jun 2008 08:25:40 +0000
-----------------

-----------------
Assigned to: Julien Vermillard
-----------------

-----------------
Description: 

To reproduce you can simply run the
EchoServer from mina-example and use
AprIoAcceptor instead of NioAcceptor.  I
used the EchoClient from Julien
Vermillard's sandbox here: <a
href="https://svn.apache.org/repos/asf/mina/sandbox/jvermillard/"
class="external-link"
rel="nofollow">https://svn.apache.org/repos/asf/mina/sandbox/jvermillard/</a>
and used 20 or 30 concurrent
connections.

AprIoProcessor.destroy()
is called multiple times when an
exception is generated in
AbstractPollingIoProcessor (RST, etc.)
and either epoll or apr doesn't like to
remove a closed fd from the pollset.  I
believe that destroy is called twice
because AprIoProcessor.state() returns
SessionState.OPEN when the native fd is
&gt; 0.  I don't believe once open it
will ever be 0 again.

I was able to fix
the problem by explicitly settion
AprSession.descriptor to 0 after the
socket was closed although I'm not sure
this is the correct solution.
 
