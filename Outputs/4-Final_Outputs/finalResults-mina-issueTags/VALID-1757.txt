Pattern changes caused by commit: c4df7cd835c22ea75e72411c2ea5776bf8d5ae53

From: Facade-5
To:   Facade-4

From: Proxy-0
To:   Proxy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-1757.txt 

commit c4df7cd835c22ea75e72411c2ea5776bf8d5ae53
Author: Julien Vermillard <jvermillard@apache.org>

    DIRMINA-719 firing message sent event from serial writes



==================================
 Issue DIRMINA-719 Description 
=======================================

Project: MINA
-----------------

-----------------
Title: [DIRMINA-719] Serial Filter Chain Broken For Outbound Data
-----------------

-----------------
Summary: Serial Filter Chain Broken For Outbound Data
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Closed
-----------------

-----------------
Created at: Thu, 18 Jun 2009 13:40:30 +0000
-----------------

-----------------
Resolved at: Tue, 18 Aug 2009 15:37:44 +0000
-----------------

-----------------
Assigned to: Julien Vermillard
-----------------

-----------------
Description: 

IoFilterAdapter-descended filter's
messageSent() hook called only with
0-byte (Mina internal indicator, I'm
told) IoBuffer data, not with IoBuffer
containing data actually sent out the
serial port.

Filter object looks
like:
<div class="code panel"
style="border-width: 1px;"><div
class="codeContent panelContent"><pre
class="code-java"><span
class="code-keyword">public</span> <span
class="code-keyword">class
</span>CaptureLogFilter <span
class="code-keyword">extends</span>
IoFilterAdapter {...   @Override   <span
class="code-keyword">public</span> void
messageReceived(NextFilter nextFilter,
IoSessionsession, <span
class="code-object">Object</span>
message) <span
class="code-keyword">throws</span>
Exception {       log(<span
class="code-quote">"RECEIVED: "</span>,
message);       <span
class="code-keyword">if</span>
(nextFilter != <span
class="code-keyword">null</span> )
nextFilter.messageReceived(session,message);
  }   @Override   <span
class="code-keyword">public</span> void
messageSent(NextFilter nextFilter,
IoSession session,WriteRequest
writeRequest) <span
class="code-keyword">throws</span>
Exception {       log(<span
class="code-quote">"SENT: "</span>,
writeRequest.getMessage());       <span
class="code-keyword">if</span>
(nextFilter != <span
class="code-keyword">null</span> )
nextFilter.messageSent(session,writeRequest);
  }...   <span
class="code-keyword">private</span> void
log(<span
class="code-object">String</span> event,
<span class="code-object">Object</span>
arg) {       <span
class="code-keyword">if</span> (arg !=
<span class="code-keyword">null</span>
&amp;&amp; arg <span
class="code-keyword">instanceof</span>
IoBuffer) {           <span
class="code-object">byte</span> b[] =
IoBufferUtils.asBytes((IoBuffer) arg);  
        log(event + b.length + <span
class="code-quote">" bytes: "</span> +
ByteUtils.toHex(b));<span
class="code-comment">//           
IoBuffer i = (IoBuffer)arg;</span><span
class="code-comment">//           
log(<span class="code-quote">"DBG:
"</span> + event + <span
class="code-quote">"pos: "</span> +
i.position() + ",
lim:</span>"+i.limit());<span
class="code-comment">// Previous debug
was added to confirm IoBufferUtils
operation, the IoBuffer <span
class="code-quote">'arg'</span> is
confirmed empty (both position &amp;
limit are 0)</span>       }       <span
class="code-keyword">else</span>
log(event);  
}...}</pre></div></div>
And is hooked in
the IoConnector set up:
<div class="code
panel" style="border-width: 1px;"><div
class="codeContent panelContent"><pre
class="code-java">   <span
class="code-keyword">private</span>
<span class="code-keyword">final</span>
IoConnector buildIoConnector() {...     
 <span class="code-keyword">if</span> (
codecFilter == <span
class="code-keyword">null</span> )      
    codecFilter = <span
class="code-keyword">new</span>
ProtocolCodecFilter(createCodecFactory());...
      DefaultIoFilterChainBuilder fc =
connector.getFilterChain();       <span
class="code-keyword">if</span> (
fc.contains(<span
class="code-quote">"logging"</span>) )
fc.remove(<span
class="code-quote">"logging"</span>);   
   <span class="code-keyword">if</span>
( fc.contains(<span
class="code-quote">"codec"</span>) )
fc.remove(<span
class="code-quote">"codec"</span>);     
 fc.addLast(<span
class="code-quote">"logging"</span>,
<span
class="code-keyword">new</span>CaptureLogFilter(getClass().getSimpleName()));
      fc.addLast(<span
class="code-quote">"codec"</span>,
codecFilter);...}</pre></div></div> 
