Pattern changes caused by commit: dd5a4bf0e9d8a511d8c2e2c16913abf8f2b1990d

From: Abstract Factory-2
To:   Abstract Factory-1

From: Factory Method-2
To:   Factory Method-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-8219.txt 

commit dd5a4bf0e9d8a511d8c2e2c16913abf8f2b1990d
Author: Jonathan Ellis <jbellis@apache.org>

    Fallback to old manifest if most recent is unparseable
    patch by Carl Yeksigian; reviewed by jbellis for CASSANDRA-5041



==================================
 Issue CASSANDRA-5041 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-5041] Change LeveledManifest to try to load old and tmp json files
-----------------

-----------------
Summary: Change LeveledManifest to try to load old and tmp json files
-----------------

-----------------
Issue type: Improvement
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Fri, 7 Dec 2012 17:20:10 +0000
-----------------

-----------------
Resolved at: Tue, 11 Dec 2012 03:20:27 +0000
-----------------

-----------------
Assigned to: Carl Yeksigian
-----------------

-----------------
Description: 

Even though leveled compaction creates an old and a tmp file while writing out a new
file, the leveled manifest does not attempt to load those files.
 

-----------------

-----------------
Comments: 

New Comment: 
Tries recovering using tmp, then old files. 


New Comment: 
tmp will usually be a partially written file so using that is not appropriate. 


New Comment: 
That means that it won't be parseable, so we'll fall back to the old file instead. 


New Comment: 
Firmly convinced that trying to load tmp is misguided.  At best it will be misleading to
someone reading the code.  The odds of a failure such that loading the tmp will be useful
are literally negligible.Assuming we cut this back to loading the old file, does this do
the Right Thing if sstables are mentioned in the manifest that no longer actually exist? 


New Comment: 
P.S. Please note brace formatting in <a href="http://wiki.apache.org/cassandra/CodeStyle"
class="external-link" rel="nofollow">http://wiki.apache.org/cassandra/CodeStyle</a>.  Yes,
it's nonstandard, but best to maintain consistency. 


New Comment: 
I see your point on the temp file &#8211; I've removed that. Was being a little
opportunistic, but since it doesn't really make sense in 99% of the cases, doesn't
matter.Yes, it will do the right thing if an sstable is mentioned in the manifest, but not
present since it compares the sstables present against the members. Also, the other way
works: if an sstable is present but not mentioned, it will not be loaded into a level (and
thus treated as level 0).I've also updated my code style. 


New Comment: 
Hmm, not sure what happened with v2, I'm getting<div class="preformatted panel"
style="border-width: 1px;"><div class="preformattedContent panelContent"><pre>$ patch -p1
&lt; ~/.JIRAClient/download/5041-v2.patch can't find file to patch at input line 10Perhaps
you used the wrong -p or --strip option?The text leading up to this
was:--------------------------|Index:
src/java/org/apache/cassandra/db/compaction/LeveledManifest.java|IDEA additional
info:|Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP|&lt;+&gt;UTF-8|Subsystem:
com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP|&lt;+&gt;/*\n * Licensed to
the Apache Software Foundation (ASF) under one\n * or more contributor license
a</pre></div></div>Anecdotally, <tt>git diff</tt> tends to be more reliable than IDE
diffing. 


New Comment: 
I didn't realize how huge that patch was until after I added it to jira (included the
whole file in a diff for some reason).I've attached v3 which was git diff'd. 


