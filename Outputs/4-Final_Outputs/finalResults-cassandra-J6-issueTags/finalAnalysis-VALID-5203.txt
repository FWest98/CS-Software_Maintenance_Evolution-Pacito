Pattern changes caused by commit: b256611af1affbfc3f001371e7423c03e44b6f55

From: Decorator-1
To:   Decorator-0

From: Flyweight-4
To:   Flyweight-5

From: Strategy-1
To:   Strategy-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-5203.txt 

commit b256611af1affbfc3f001371e7423c03e44b6f55
Author: Jonathan Ellis <jbellis@apache.org>

    update CQL grammar to require key clause in delete statement
    patch by pyaskevich; reviewed by jbellis for CASSANDRA-3349



==================================
 Issue CASSANDRA-3349 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3349] NPE on malformed CQL
-----------------

-----------------
Summary: NPE on malformed CQL
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Tue, 11 Oct 2011 21:17:12 +0000
-----------------

-----------------
Resolved at: Wed, 12 Oct 2011 14:53:23 +0000
-----------------

-----------------
Assigned to: Pavel Yaskevich
-----------------

-----------------
Description: 

It's not clear why, but the CQL grammar specification in Cql.g allows for an empty WHERE
clause on DELETE, i.e.:
<div class="preformatted panel" style="border-width: 1px;"><div
class="preformattedContent panelContent"><pre>DELETE FROM someCF
WHERE;</pre></div></div>
When this is used, with or without a column list, it causes an
NPE on the node processing the CQL. Traceback on a recent 1.0.0 build:
<div
class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent
panelContent"><pre>ERROR [pool-2-thread-1] 2011-10-11 15:45:25,655 Cassandra.java (line
4082) Internal error processing execute_cql_queryjava.lang.NullPointerException        at
org.apache.cassandra.cql.CqlParser.deleteStatement(CqlParser.java:1994)        at
org.apache.cassandra.cql.CqlParser.query(CqlParser.java:292)        at
org.apache.cassandra.cql.QueryProcessor.getStatement(QueryProcessor.java:984)        at
org.apache.cassandra.cql.QueryProcessor.process(QueryProcessor.java:500)        at
org.apache.cassandra.thrift.CassandraServer.execute_cql_query(CassandraServer.java:1268)  
     at
org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.process(Cassandra.java:4072)
       at org.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:2889)    
   at
org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:187)
       at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)       
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)       
at java.lang.Thread.run(Thread.java:680)</pre></div></div>
The CQL client gets an error
with the message, "Internal application error".

It might be better to allow leaving off
the "WHERE" as well as the condition, to match SQL semantics, although fixing that
probably won't solve this problem.
 

-----------------

-----------------
Comments: 

New Comment: 
We don't want to allow leaving it off, because we don't support scan-and-delete
server-side. (And truncate is far more performant.)I'd rather fix by requiring the rest of
the WHERE. 


New Comment: 
rebased with the latest 0.8 branch (last commit 9b9c4d32973ea4e586031775b3322180169135cd) 


New Comment: 
+1 


New Comment: 
committed 


