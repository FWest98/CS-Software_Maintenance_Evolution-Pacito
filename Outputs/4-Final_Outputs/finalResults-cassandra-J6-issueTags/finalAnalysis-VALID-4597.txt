Pattern changes caused by commit: c1ea784cbc1a66e05369c8848b150d5ec9c7d266

From: Decorator-1
To:   Decorator-0

From: Mediator-3
To:   Mediator-2


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-4597.txt 

commit c1ea784cbc1a66e05369c8848b150d5ec9c7d266
Author: Jonathan Ellis <jbellis@apache.org>

    don't hardcode JAVA_HOME in RH init script
    patch by Paul Cannon; reviewed by Taras Puchko for CASSANDRA-2992



==================================
 Issue CASSANDRA-2992 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-2992] Cassandra doesn't start on Red Hat Linux due to hardcoded JAVA_HOME
-----------------

-----------------
Summary: Cassandra doesn't start on Red Hat Linux due to hardcoded JAVA_HOME
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Thu, 4 Aug 2011 14:26:42 +0000
-----------------

-----------------
Resolved at: Mon, 8 Aug 2011 13:11:00 +0000
-----------------

-----------------
Assigned to: paul cannon
-----------------

-----------------
Description: 

On CentOS /etc/init.d/cassandra has
<blockquote>
export
JAVA_HOME=/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0/
</blockquote>
While there is no such a
directory on our server it was ok for 0.8.2, because /usr/sbin/cassandra checked the
executable
<blockquote>
if [ -x $JAVA_HOME/bin/java ]; then<br/>   
JAVA=$JAVA_HOME/bin/java<br/>else<br/>    JAVA=`which java`<br/>fi
</blockquote>
But 0.8.3
builds replaced the above code with one that doesn't check if JAVA_HOME is set
correctly.
<blockquote>
if [ -n "$JAVA_HOME" ]; then<br/>   
JAVA="$JAVA_HOME/bin/java"<br/>else<br/>    JAVA=java<br/>fi
</blockquote>
That's why
cassandra doesn't start anymore.

The correct fix would be to remove "export JAVA_HOME"
from /etc/init.d/cassandra or set it only to correct path and only if it hasn't already
been set.

It would also be nice to revert to "[ -x $JAVA_HOME/bin/java ]" in
/usr/sbin/cassandra
 

-----------------

-----------------
Comments: 

New Comment: 
Is this fixed by <a href="https://issues.apache.org/jira/browse/CASSANDRA-2785"
title="should export JAVA variable in the bin/cassandra and use that in the
cassandra-env.sh when check for the java version" class="issue-link"
data-issue-key="CASSANDRA-2785"><del>CASSANDRA-2785</del></a> ? 


New Comment: 
No, <a href="https://issues.apache.org/jira/browse/CASSANDRA-2785" title="should export
JAVA variable in the bin/cassandra and use that in the cassandra-env.sh when check for the
java version" class="issue-link"
data-issue-key="CASSANDRA-2785"><del>CASSANDRA-2785</del></a> actually caused this bug,
since now invalid JAVA_HOME is not ignored:<br/><a
href="http://svn.apache.org/viewvc/cassandra/branches/cassandra-0.8/bin/cassandra?r1=1126728&amp;r2=1152241&amp;pathrev=1152241"
class="external-link"
rel="nofollow">http://svn.apache.org/viewvc/cassandra/branches/cassandra-0.8/bin/cassandra?r1=1126728&amp;r2=1152241&amp;pathrev=1152241</a>But
the real bug is setting JAVA_HOME to a fixed value in redhat specific scripts. 


New Comment: 
I don't want to get into the business of second-guessing the admin when a configuration
parameter is set, so I vote we fix the hard-coded JAVA_HOME in redhat/cassandra. Probably
by borrowing the jvm search stuff from debian/init and adjusting the directory list
appropriately. 


New Comment: 
so, use existing JAVA_HOME if set, else search for it?  sounds good to me. 


New Comment: 
0001: add search for appropriate JAVA_HOME in redhat initscript, now that cassandra-env.sh
expects the right $JAVA to be preconfigured (see #2785). 


New Comment: 
Taras, would you mind verifying that the list of JVM search dirs I included matches what
you expect to find? I'm not as familiar with the range of java deployment practices on
RH-based OSes. 


New Comment: 
Our system administrators say the patch is perfect. 


New Comment: 
Committed. 


New Comment: 
Note that <a href="https://issues.apache.org/jira/browse/CASSANDRA-2785" title="should
export JAVA variable in the bin/cassandra and use that in the cassandra-env.sh when check
for the java version" class="issue-link"
data-issue-key="CASSANDRA-2785"><del>CASSANDRA-2785</del></a> was reverted for the second
0.8.3 vote, so I'm updating both affects and fix-for versions to 0.8.4. 


