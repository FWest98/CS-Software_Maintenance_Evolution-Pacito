Pattern changes caused by commit: 8eb2fed1ebcbb9a1dd6d64673e8b9aede577660e

From: Decorator-2
To:   Decorator-1

From: Flyweight-2
To:   Flyweight-1

From: Mediator-3
To:   Mediator-1

From: Strategy-0
To:   Strategy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-7381.txt 

commit 8eb2fed1ebcbb9a1dd6d64673e8b9aede577660e
Author: Yuki Morishita <yukim@apache.org>

    Respect 5min flush moratorium after CL replay; patch by yukim reviewed by jbellis for CASSANDRA-4474



==================================
 Issue CASSANDRA-4474 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-4474] Respect five-minute flush moratorium after initial CL replay
-----------------

-----------------
Summary: Respect five-minute flush moratorium after initial CL replay
-----------------

-----------------
Issue type: Improvement
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Mon, 30 Jul 2012 21:59:16 +0000
-----------------

-----------------
Resolved at: Wed, 5 Sep 2012 15:22:29 +0000
-----------------

-----------------
Assigned to: Yuki Morishita
-----------------

-----------------
Description: 

As noted in <a href="https://issues.apache.org/jira/browse/CASSANDRA-1967" title="commit
log replay shouldn&#39;t end with a flush" class="issue-link"
data-issue-key="CASSANDRA-1967"><del>CASSANDRA-1967</del></a>, the post-replay flush can
kick off compactions before the five minute grace period introduced in <a
href="https://issues.apache.org/jira/browse/CASSANDRA-3181" title="Compaction fails to
occur" class="issue-link" data-issue-key="CASSANDRA-3181"><del>CASSANDRA-3181</del></a> to
avoid i/o contention while server is warming up.
 

-----------------

-----------------
Comments: 

New Comment: 
Jonathan,Do you mean flush after commit log recovery should not trigger compaction so that
5-min grace compaction can pick that up? I'm thinking to disable compaction until commit
log is fully replayed and after that, enable compaction and schedule 5-min one shot
compaction. 


New Comment: 
Right, that's what I meant.  Your solution sounds perfect. 


New Comment: 
Attaching patch to disable auto compaction until commit log replay
ends.5min-grace-compaction is moved from each AbstractCompactionStrategy to
AbstractCassandraDaemon, and now it will try to compact <b>all</b> CFs if there are no
compactions. I think this is OK since original goal of this is to kick off compaction even
though there are no activities. 


New Comment: 
I think the (existing) "is compaction manager idle" check is bogus: if we have enough CFs
that CM starts working on the first, before it finishes looping over everyone, then some
CFs will never have compaction kicked off.  Suggest just blindly submitting the background
compaction, which will no-op if it's redundant (which is what flush does as
well).Otherwise LGTM. 


New Comment: 
Committed after removing compaction manager idle check. Thanks! 


New Comment: 
Integrated in Cassandra #2046 (See <a href="https://builds.apache.org/job/Cassandra/2046/"
class="external-link"
rel="nofollow">https://builds.apache.org/job/Cassandra/2046/</a>)<br/>    Respect 5min
flush moratorium after CL replay; patch by yukim reviewed by jbellis for <a
href="https://issues.apache.org/jira/browse/CASSANDRA-4474" title="Respect five-minute
flush moratorium after initial CL replay" class="issue-link"
data-issue-key="CASSANDRA-4474"><del>CASSANDRA-4474</del></a> (Revision
8eb2fed1ebcbb9a1dd6d64673e8b9aede577660e)     Result = ABORTED<br/>yukim : <br/>Files :
<ul>	<li>src/java/org/apache/cassandra/db/compaction/AbstractCompactionStrategy.java</li>	<li>src/java/org/apache/cassandra/utils/DefaultInteger.java</li>	<li>src/java/org/apache/cassandra/service/AbstractCassandraDaemon.java</li>	<li>src/java/org/apache/cassandra/db/ColumnFamilyStore.java</li></ul> 


