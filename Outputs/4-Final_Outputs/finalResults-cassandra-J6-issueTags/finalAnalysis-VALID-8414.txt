Pattern changes caused by commit: ccdb632d4005165efdc65dfa3aa0a1799ae0a87b

From: Abstract Factory-1
To:   Abstract Factory-2

From: Factory Method-1
To:   Factory Method-2

From: Decorator-2
To:   Decorator-1

From: Facade-0
To:   Facade-1

From: Flyweight-2
To:   Flyweight-1

From: Mediator-3
To:   Mediator-1

From: Strategy-0
To:   Strategy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-8414.txt 

commit ccdb632d4005165efdc65dfa3aa0a1799ae0a87b
Author: Jonathan Ellis <jbellis@apache.org>

    re-allow wrapping ranges for start_token/end_token range pairing
    patch by jbellis; reviewed by brandonwilliams for CASSANDRA-5106



==================================
 Issue CASSANDRA-5106 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-5106] Stock example for using pig throws InvalidRequestException(why:Start token sorts after end token)
-----------------

-----------------
Summary: Stock example for using pig throws InvalidRequestException(why:Start token sorts after end token)
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Thu, 3 Jan 2013 21:43:12 +0000
-----------------

-----------------
Resolved at: Thu, 10 Jan 2013 18:52:20 +0000
-----------------

-----------------
Assigned to: Jonathan Ellis
-----------------

-----------------
Description: 

The setup:<br/>This is from
printenv<br/>HADOOP_HOME=/home/Downloads/hadoop-1.1.1<br/>PIG_HOME=/home/Downloads/pig-0.10.0<br/>PIG_INITIAL_ADDRESS=localhost<br/>PIG_RPC_PORT=9160<br/>PIG_PARTITIONER=org.apache.cassandra.dht.Murmur3Partitioner

This
is from cassandra-cli<br/><span class="error">&#91;default@PigTest&#93;</span> describe
cluster;<br/>Cluster Information:<br/>   Snitch:
org.apache.cassandra.locator.SimpleSnitch<br/>   Partitioner:
org.apache.cassandra.dht.Murmur3Partitioner<br/>   Schema versions:<br/>       
b5fc9a82-fbdd-3cf5-af16-9c498c9f9a5c: <span
class="error">&#91;127.0.0.1&#93;</span>

Running test_storage.pig
as<br/>bin/pig_cassandra -x local test/test_storage.pig<br/>after populating the cf
as<br/>cassandra-cli --host localhost --port 9160 &lt; populate-cli.txt<br/>throws
<br/>2013-01-03 02:20:47,626 <span class="error">&#91;Thread-4&#93;</span> INFO 
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader - Current
spli<br/>t being processed ColumnFamilySplit((-1, '-1728690256123413808] @<span
class="error">&#91;localhost.localdomain&#93;</span>)<br/>2013-01-03 02:20:47,758 <span
class="error">&#91;Thread-4&#93;</span> WARN  org.apache.hadoop.mapred.FileOutputCommitter
- Output path is null in cleanup<br/>2013-01-03 02:20:47,760 <span
class="error">&#91;Thread-4&#93;</span> WARN  org.apache.hadoop.mapred.LocalJobRunner -
job_local_0001<br/>java.lang.RuntimeException: InvalidRequestException(why:Start token
sorts after end token)<br/>        at
org.apache.cassandra.hadoop.ColumnFamilyRecordReader$StaticRowIterator.maybeInit(ColumnFamilyRecordReader.java:384)<br/>
       at
org.apache.cassandra.hadoop.ColumnFamilyRecordReader$StaticRowIterator.computeNext(ColumnFamilyRecordReader.java:390)<br/>
       at
org.apache.cassandra.hadoop.ColumnFamilyRecordReader$StaticRowIterator.computeNext(ColumnFamilyRecordReader.java:313)<br/>
       at
com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:143)<br/>
       at
com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:138)<br/>       
at
org.apache.cassandra.hadoop.ColumnFamilyRecordReader.nextKeyValue(ColumnFamilyRecordReader.java:184)<br/>
       at
org.apache.cassandra.hadoop.pig.CassandraStorage.getNext(CassandraStorage.java:226)<br/>  
     at
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader.nextKeyValue(PigRecordReader.java:194)<br/>
       at
org.apache.hadoop.mapred.MapTask$NewTrackingRecordReader.nextKeyValue(MapTask.java:532)<br/>
       at org.apache.hadoop.mapreduce.MapContext.nextKeyValue(MapContext.java:67)<br/>    
   at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:143)<br/>        at
org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)<br/>        at
org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)<br/>        at
org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:212)<br/>Caused by:
InvalidRequestException(why:Start token sorts after end token)<br/>        at
org.apache.cassandra.thrift.Cassandra$get_range_slices_result.read(Cassandra.java:12916)<br/>
       at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:78)<br/>       
at
org.apache.cassandra.thrift.Cassandra$Client.recv_get_range_slices(Cassandra.java:734)<br/>
       at
org.apache.cassandra.thrift.Cassandra$Client.get_range_slices(Cassandra.java:718)<br/>    
   at
org.apache.cassandra.hadoop.ColumnFamilyRecordReader$StaticRowIterator.maybeInit(ColumnFamilyRecordReader.java:346)<br/>
       ... 13 more
 

-----------------

-----------------
Comments: 

New Comment: 
You probably have exported PIG_PARTITIONER=org.apache.cassandra.dht.RandomPartitioner, but
1.2 is using the default partitioner.  I've updated the README.txt instructions in
examples/pig to use the m3 partitioner instead. 


New Comment: 
Hi,<br/>Still having the same exception thrown even with
PIG_PARTITIONER=org.apache.cassandra.dht.Murmur3Partitioner 


New Comment: 
Regression from <a href="https://issues.apache.org/jira/browse/CASSANDRA-5076"
title="Murmur3Partitioner#describeOwnership calculates ownership% wrong"
class="issue-link" data-issue-key="CASSANDRA-5076"><del>CASSANDRA-5076</del></a> 


New Comment: 
This issue indeed comes from <a
href="https://issues.apache.org/jira/browse/CASSANDRA-5089" title="get_range_slices does
not validate end_token" class="issue-link"
data-issue-key="CASSANDRA-5089"><del>CASSANDRA-5089</del></a>.<br/>WordCount does fail in
latest cassandra-1.1 branch with the same exception. 


New Comment: 
Closing in favor of <a href="https://issues.apache.org/jira/browse/CASSANDRA-5089"
title="get_range_slices does not validate end_token" class="issue-link"
data-issue-key="CASSANDRA-5089"><del>CASSANDRA-5089</del></a> 


New Comment: 
Reopening to avoid polluting fixver on 5089. 


New Comment: 
patch to re-allow wrapping ranges for start_token/end_token pairing 


New Comment: 
+1 


