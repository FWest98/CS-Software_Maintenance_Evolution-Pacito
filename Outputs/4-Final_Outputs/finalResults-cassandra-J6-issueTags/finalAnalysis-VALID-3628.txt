Pattern changes caused by commit: 469f947cf7322f0f5edae7331972a14a66040a49

From: Abstract Factory-3
To:   Abstract Factory-2

From: Factory Method-3
To:   Factory Method-2


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-3628.txt 

commit 469f947cf7322f0f5edae7331972a14a66040a49
Author: Jonathan Ellis <jbellis@apache.org>

    specify UTF8Type comparator to fix regression found by Jingguo Yao
    patch by jbellis for CASSANDRA-2390



==================================
 Issue CASSANDRA-2390 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-2390] MarshalException is thrown when cassandra-cli creates the example Keyspace specified by conf/schema-sample.txt
-----------------

-----------------
Summary: MarshalException is thrown when cassandra-cli creates the example Keyspace specified by conf/schema-sample.txt
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Sat, 26 Mar 2011 16:31:21 +0000
-----------------

-----------------
Resolved at: Sun, 27 Mar 2011 05:28:56 +0000
-----------------

-----------------
Assigned to: Jonathan Ellis
-----------------

-----------------
Description: 

Use the following steps to recreate the bug:

1. Checkout the source code from trunk. For
my case, revision is 1085753.<br/>2. Run "ant" to build cassandra.<br/>3. Run
"bin/cassandra -f" to start cassandra.<br/>4. Run "bin/cassandra-cli -host localhost
--file conf/schema-sample.txt".

Then there is the following message:
<blockquote>
...
schemas agree across the cluster<br/>Line 9 =&gt;
org.apache.cassandra.db.marshal.MarshalException: cannot parse 'birthdate' as hex
bytes
</blockquote>
The root cause is BytesType's fromString method. FBUtilities's
hexToBytes method is invoked with "birthdate". NumberFormatException is thrown since
"birthdate" is not a hex string.
<div class="code panel" style="border-style:
solid;border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width:
1px;border-bottom-style: solid;"><b>BytesType.java</b></div><div class="codeContent
panelContent"><pre class="code-java">    <span class="code-keyword">public</span>
ByteBuffer fromString(<span class="code-object">String</span> source)    {        <span
class="code-keyword">try</span>        {            <span
class="code-keyword">return</span> ByteBuffer.wrap(FBUtilities.hexToBytes(source));       
}        <span class="code-keyword">catch</span> (NumberFormatException e)        {       
    <span class="code-keyword">throw</span> <span class="code-keyword">new</span>
MarshalException(<span class="code-object">String</span>.format(<span
class="code-quote">"cannot parse <span class="code-quote">'%s'</span> as hex
bytes"</span>, source), e);        }    }</pre></div></div> 

-----------------

-----------------
Comments: 

New Comment: 
<a href="https://issues.apache.org/jira/browse/CASSANDRA-2262" class="external-link"
rel="nofollow">CASSANDRA-2262</a> makes BytesType's fromString method only accept hex
strings. 


New Comment: 
fixed in r1085877 by adding comparator=UTF8Type to the CF definition.  Thanks for catching
that! 


