Pattern changes caused by commit: 0307dca20d9d641d2c715772d3a4b33f1c6642da

From: Decorator-2
To:   Decorator-1

From: Flyweight-2
To:   Flyweight-1

From: Mediator-3
To:   Mediator-1

From: Strategy-0
To:   Strategy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-7520.txt 

commit 0307dca20d9d641d2c715772d3a4b33f1c6642da
Author: Jonathan Ellis <jbellis@apache.org>

    use default consistency level in counter validation if none is explicitly provided
    patch by Nitesh Kumar; reviewed by jbellis for CASSANDRA-4700



==================================
 Issue CASSANDRA-4700 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-4700] cql 2 counter validations need to use default consistencylevel if none is explicitly given
-----------------

-----------------
Summary: cql 2 counter validations need to use default consistencylevel if none is explicitly given
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Fri, 21 Sep 2012 21:05:10 +0000
-----------------

-----------------
Resolved at: Mon, 24 Sep 2012 17:47:15 +0000
-----------------

-----------------
Assigned to: Nitesh Kumar
-----------------

-----------------
Description: 

i was trying to run cql 2 query

cqlsh:stats&gt; UPDATE Minutewise_Product_Stats SET
'2LX:OQ:XYZ.com:664230591:1:totalView'='2LX:SOQ:XYZ.com:664230591:1:totalView'+1,
'2LX:OQ:XYZ.com:664230591:1:keywordClick'='2LX:SOQ:xyz.com:664230591:1:keywordClick'+1
WHERE KEY='2017:4' ;

WHEN I GOT  this error

ERROR 20:38:46,220 Error occurred during
processing of message.<br/>java.lang.NullPointerException<br/>    at
org.apache.cassandra.cql.UpdateStatement.prepareRowMutations(UpdateStatement.java:151)<br/>
   at
org.apache.cassandra.cql.UpdateStatement.prepareRowMutations(UpdateStatement.java:128)<br/>
   at org.apache.cassandra.cql.QueryProcessor.batchUpdate(QueryProcessor.java:245)<br/>   
at org.apache.cassandra.cql.QueryProcessor.processStatement(QueryProcessor.java:563)<br/> 
  at org.apache.cassandra.cql.QueryProcessor.process(QueryProcessor.java:817)<br/>    at
org.apache.cassandra.thrift.CassandraServer.execute_cql_query(CassandraServer.java:1675)<br/>
   at
org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.getResult(Cassandra.java:3721)<br/>
   at
org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.getResult(Cassandra.java:1)<br/>
   at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:32)<br/>    at
org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:34)<br/>    at
org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:184)<br/>
   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)<br/>
   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)<br/>
   at java.lang.Thread.run(Thread.java:722)

attached is the patch file  to fix this
bug

CQL2fix.patch

diff --git a/src/java/org/apache/cassandra/cql/UpdateStatement.java
b/src/java/org/apache/cassandra/cql/UpdateStatement.java<br/>index 3a47712..0caa61b
100644<br/>&#8212; a/src/java/org/apache/cassandra/cql/UpdateStatement.java<br/>+++
b/src/java/org/apache/cassandra/cql/UpdateStatement.java<br/>@@ -146,8 +146,11 @@ public
class UpdateStatement extends AbstractModification<br/>         }

         CFMetaData
metadata = validateColumnFamily(keyspace, columnFamily, hasCommutativeOperation);
<ul
class="alternate" type="square">	<li>if
(hasCommutativeOperation)</li>	<li>cLevel.validateCounterForWrite(metadata);<br/>+       
<br/>+        if (hasCommutativeOperation){+        	ConsistencyLevel currentCLevel =
getConsistencyLevel();+        	currentCLevel.validateCounterForWrite(metadata);+       
}</li></ul>
         QueryProcessor.validateKeyAlias(metadata, keyName);
 

-----------------

-----------------
Comments: 

New Comment: 
diff --git a/src/java/org/apache/cassandra/cql/UpdateStatement.java
b/src/java/org/apache/cassandra/cql/UpdateStatement.java<br/>index 3a47712..0caa61b
100644<br/>&#8212; a/src/java/org/apache/cassandra/cql/UpdateStatement.java<br/>+++
b/src/java/org/apache/cassandra/cql/UpdateStatement.java<br/>@@ -146,8 +146,11 @@ public
class UpdateStatement extends AbstractModification<br/>         }         CFMetaData
metadata = validateColumnFamily(keyspace, columnFamily, hasCommutativeOperation);<ul
class="alternate" type="square">	<li>if
(hasCommutativeOperation)</li>	<li>cLevel.validateCounterForWrite(metadata);<br/>+       
<br/>+        if (hasCommutativeOperation){+        	ConsistencyLevel currentCLevel =
getConsistencyLevel();+        	currentCLevel.validateCounterForWrite(metadata);+       
}</li></ul>         QueryProcessor.validateKeyAlias(metadata, keyName); 


