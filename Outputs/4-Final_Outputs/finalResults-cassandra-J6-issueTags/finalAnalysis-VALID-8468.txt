Pattern changes caused by commit: a548f05dea3b845be4bbc2b532208ce8ee6b8b7f

From: Abstract Factory-2
To:   Abstract Factory-1

From: Factory Method-2
To:   Factory Method-1

From: Decorator-1
To:   Decorator-2

From: Facade-1
To:   Facade-0

From: Flyweight-2
To:   Flyweight-3

From: Mediator-1
To:   Mediator-3

From: Strategy-1
To:   Strategy-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-8468.txt 

commit a548f05dea3b845be4bbc2b532208ce8ee6b8b7f
Author: Yuki Morishita <yukim@apache.org>

    fix streaming progress report for compressed files; patch by yukim reviewed by mkjellman for CASSANDRA-5130



==================================
 Issue CASSANDRA-5130 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-5130] streaming from another node results in a bogus % streamed on that sstable
-----------------

-----------------
Summary: streaming from another node results in a bogus % streamed on that sstable
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Tue, 8 Jan 2013 06:37:08 +0000
-----------------

-----------------
Resolved at: Tue, 15 Jan 2013 18:53:39 +0000
-----------------

-----------------
Assigned to: Yuki Morishita
-----------------

-----------------
Description: 

reproducible thru a repair -pr

5689557% from node 10.8.25.132 ??
<div class="code panel"
style="border-width: 1px;"><div class="codeContent panelContent"><pre
class="code-java">root@scl-cas06:~# nodetool netstatsMode: NORMALStreaming to:
/10.8.25.132   /data2/cassandra/evidence/messages/evidence-messages-ia-2378-Data.db
sections=1504 progress=10877426741/11376970910 - 95%  
/data/cassandra/evidence/messages/evidence-messages-ia-2396-Data.db sections=1326
progress=0/747963031 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2412-Data.db sections=342
progress=0/29791995 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2413-Data.db sections=307
progress=0/42375841 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2375-Data.db sections=702
progress=0/5138101708 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2416-Data.db sections=220
progress=0/21729661 - 0%  
/data2/cassandra/evidence/messages/evidence-messages-ia-2382-Data.db sections=1498
progress=0/7731727694 - 0%  
/data2/cassandra/evidence/messages/evidence-messages-ia-2388-Data.db sections=698
progress=0/2097813910 - 0%  
/data2/cassandra/evidence/messages/evidence-messages-ia-2401-Data.db sections=889
progress=0/154218729 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2411-Data.db sections=290
progress=0/45457960 - 0%  
/data2/cassandra/evidence/messages/evidence-messages-ia-2414-Data.db sections=22
progress=0/1809989 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2407-Data.db sections=423
progress=0/55302683 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2409-Data.db sections=73
progress=0/6366250 - 0%  
/data2/cassandra/evidence/messages/evidence-messages-ia-2377-Data.db sections=1298
progress=0/815617310 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2389-Data.db sections=167
progress=0/7307457 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-2415-Data.db sections=126
progress=0/9260301 - 0% Nothing streaming to /10.8.30.16Streaming from: /10.8.25.132  
evidence: /data2/cassandra/evidence/messages/evidence-messages-ia-1091-Data.db
sections=328 progress=0/52507334 - 0%   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-1084-Data.db sections=1029
progress=0/198699737 - 0%   evidence:
/data2/cassandra/evidence/messages/evidence-messages-ia-1097-Data.db sections=35
progress=0/731705 - 0%   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-1079-Data.db sections=1504
progress=1126955908333568/19807443126 - 5689557%Pool Name                    Active  
Pending      CompletedCommands                        n/a         0        
459801Responses                       n/a         0        1061826</pre></div></div> 

-----------------

-----------------
Comments: 

New Comment: 
1141023% on this node?<div class="code panel" style="border-width: 1px;"><div
class="codeContent panelContent"><pre class="code-java">root@scl-cas10:~# nodetool
netstatsMode: NORMALStreaming to: /10.8.30.103  
/data/cassandra/evidence/messages/evidence-messages-ia-1079-Data.db sections=1504
progress=12737080525/19807443126 - 64%  
/data2/cassandra/evidence/messages/evidence-messages-ia-1097-Data.db sections=35
progress=0/731705 - 0%  
/data/cassandra/evidence/messages/evidence-messages-ia-1084-Data.db sections=1029
progress=0/198699737 - 0%  
/data2/cassandra/evidence/messages/evidence-messages-ia-1091-Data.db sections=328
progress=0/52507334 - 0%Streaming from: /10.8.30.103   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-2375-Data.db sections=702
progress=58626960326656/5138101708 - 1141023%   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-2389-Data.db sections=167
progress=0/7307457 - 0%   evidence:
/data2/cassandra/evidence/messages/evidence-messages-ia-2388-Data.db sections=698
progress=0/2097813910 - 0%   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-2416-Data.db sections=220
progress=0/21729661 - 0%   evidence:
/data2/cassandra/evidence/messages/evidence-messages-ia-2377-Data.db sections=1298
progress=0/815617310 - 0%   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-2409-Data.db sections=73
progress=0/6366250 - 0%   evidence:
/data2/cassandra/evidence/messages/evidence-messages-ia-2414-Data.db sections=22
progress=0/1809989 - 0%   evidence:
/data2/cassandra/evidence/messages/evidence-messages-ia-2382-Data.db sections=1498
progress=0/7731727694 - 0%   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-2407-Data.db sections=423
progress=0/55302683 - 0%   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-2411-Data.db sections=290
progress=0/45457960 - 0%   evidence:
/data/cassandra/evidence/messages/evidence-messages-ia-2415-Data.db sections=126
progress=0/9260301 - 0%   evidence:
/data2/cassandra/evidence/messages/evidence-messages-ia-2401-Data.db sections=889
progress=0/154218729 - 0%Pool Name                    Active   Pending     
CompletedCommands                        n/a         0         252046Responses            
          n/a         3         746069</pre></div></div> 


New Comment: 
related to <a href="https://issues.apache.org/jira/browse/CASSANDRA-4687"
class="external-link"
rel="nofollow">https://issues.apache.org/jira/browse/CASSANDRA-4687</a> ? streaming wrong
part of file? 


New Comment: 
Do you have key cache on? 


New Comment: 
key_cache_size_in_mb: 0 


New Comment: 
I somehow screwed calculating progress of compressed file transferred. Fix attached. 


New Comment: 
+1 on patch and i'll make a build to actually test it to be extra sure in a moment 


New Comment: 
confirmed stream progress is being correctly calculated 


