Pattern changes caused by commit: 4764a379e295bdc68612359a26bf96a8833823c8

From: Decorator-2
To:   Decorator-1

From: Facade-1
To:   Facade-0

From: Flyweight-2
To:   Flyweight-4

From: Mediator-3
To:   Mediator-2

From: Strategy-0
To:   Strategy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-7327.txt 

commit 4764a379e295bdc68612359a26bf96a8833823c8
Author: Jonathan Ellis <jbellis@apache.org>

    fix toString of hint destination tokens
    patch by brandonwilliams; reviewed by jbellis for CASSANDRA-4568



==================================
 Issue CASSANDRA-4568 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-4568] countPendingHints JMX operation is returning garbage for the key
-----------------

-----------------
Summary: countPendingHints JMX operation is returning garbage for the key
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Wed, 22 Aug 2012 19:29:28 +0000
-----------------

-----------------
Resolved at: Tue, 28 Aug 2012 14:32:42 +0000
-----------------

-----------------
Assigned to: Brandon Williams
-----------------

-----------------
Description: 

countPendingHints JMX operation should return a map from key: endpoint IP address to
value: number of pending hints. It is returning garbage for the key (looks like binary
data concerning the hint itself). The value looks correct.

Steps to reproduce:

1) Set up
a two-node cluster. 

2) Disable gossip on the second node.  

`nodetool ring` output from
node 1:

Address         DC          Rack        Status State   Load           
Effective-Ownership Token                                       <br/>                     
                                                                    
85070591730234615865843651857942052864      <br/>192.168.1.162   datacenter1 rack1      
Up     Normal  21.46 KB        100.00%             0                                      
    <br/>192.168.1.130   datacenter1 rack1       Down   Normal  6.67 KB         100.00%   
         85070591730234615865843651857942052864      

3) While the second node is still
down, create a keyspace with RF=2 and a CF within this keyspace. Then insert two records
into the CF:

Connected to Test Cluster at 192.168.1.162:9160.<br/><span
class="error">&#91;cqlsh 2.2.0 | Cassandra 1.1.2 | CQL spec 2.0.0 | Thrift protocol
19.32.0&#93;</span><br/>Use HELP for help.<br/>cqlsh&gt; create KEYSPACE demo WITH
strategy_class = 'SimpleStrategy' AND strategy_options:replication_factor =
2;<br/>cqlsh&gt; use demo;<br/>cqlsh:demo&gt; create table users (username varchar primary
key, password varchar);<br/>cqlsh:demo&gt; insert into users (username, password) values
(scott, tiger);<br/>cqlsh:demo&gt; insert into users (username, password) values (root,
password);

4) Use a JMX client to execute the countPendingHints operation:

jblangston:~
jblangston$ java -jar cmdline-jmxclient-0.10.3.jar - localhost:7199
org.apache.cassandra.db:type=HintedHandoffManager countPendingHints

08/22/2012 14:21:37
-0500 org.archive.jmx.Client countPendingHints: 
{@B^h
??	?[b??scottdemoscott?????password?ߞHtigerdemoF?P??	?[b??rootdemoroot?????password?ߞ?Wpassworddemo=2}
5)
Notice the output.  The value (2) is correct but the key is garbage instead of an endpoint
IP address.
 

-----------------

-----------------
Comments: 

New Comment: 
Patch to correctly display the token. 


New Comment: 
why not just use r.key.token?+1 otherwise. 


