Pattern changes caused by commit: 044eb1edea40b748ee34c3bb077fdedcc039e38c

From: Facade-1
To:   Facade-0

From: Flyweight-3
To:   Flyweight-4


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-5769.txt 

commit 044eb1edea40b748ee34c3bb077fdedcc039e38c
Author: Pavel Yaskevich <povel.y@gmail.com>

    fix CLI `show schema` command insert of an extra comma in column_metadata
    patch by Yuki Morishita; reviewed by Pavel Yaskevich for CASSANDRA-3714



==================================
 Issue CASSANDRA-3714 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3714] Show Schema; inserts an extra comma in column_metadata
-----------------

-----------------
Summary: Show Schema; inserts an extra comma in column_metadata
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Mon, 9 Jan 2012 23:43:21 +0000
-----------------

-----------------
Resolved at: Tue, 10 Jan 2012 17:27:59 +0000
-----------------

-----------------
Assigned to: Yuki Morishita
-----------------

-----------------
Description: 

create column family inode<br/>  with column_type = 'Standard'<br/>  and comparator =
'DynamicCompositeType(t=&gt;org.apache.cassandra.db.marshal.TimeUUIDType,s=&gt;org.apache.cassandra.db.marshal.UTF8Type,b=&gt;org.apache.cassandra.db.marshal.BytesType)'<br/>
 and default_validation_class = 'BytesType'<br/>  and key_validation_class =
'BytesType'<br/>  and rows_cached = 0.0<br/>  and row_cache_save_period = 0<br/>  and
row_cache_keys_to_save = 2147483647<br/>  and keys_cached = 1000000.0<br/>  and
key_cache_save_period = 14400<br/>  and read_repair_chance = 1.0<br/>  and gc_grace =
60<br/>  and min_compaction_threshold = 4<br/>  and max_compaction_threshold = 32<br/> 
and replicate_on_write = true<br/>  and row_cache_provider =
'ConcurrentLinkedHashCacheProvider'<br/>  and compaction_strategy =
'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy'<br/>  and comment =
'Stores file meta data'<br/>  and column_metadata = [<br/>    {column_name :
'b@70617468',<br/>    validation_class : BytesType,<br/>    index_name : 'path',<br/>   
index_type : 0,<br/>},<br/>    {column_name : 'b@73656e74696e656c',<br/>   
validation_class : BytesType,<br/>    index_name : 'sentinel',<br/>    index_type :
0,<br/>},<br/>    {column_name : 'b@706172656e745f70617468',<br/>    validation_class :
BytesType,<br/>    index_name : 'parent_path',<br/>    index_type : 0,<br/>}];

That's
that was outputted when I ran show schema. When I tried it on a new cluster, it failed
since the commas after 'index_type: 0' were present.

Proposed fixes:<br/>1. Allow
trailing commas<br/>2. Do not output trailing commas
 

-----------------

-----------------
Comments: 

New Comment: 
Deleting comment. Wrong window. <img class="emoticon"
src="https://issues.apache.org/jira/images/icons/emoticons/smile.png" height="16"
width="16" align="absmiddle" alt="" border="0"/> 


New Comment: 
Confirmed bug only on cassandra-1.0 branch.<br/>Patch attached to eliminate last comma
from hash representation. 


New Comment: 
Tested in 0.8.8 and saw this:<div class="preformatted panel" style="border-width:
1px;"><div class="preformattedContent panelContent"><pre>create column family inode  with
column_type = 'Standard'  and comparator =
'DynamicCompositeType(t=&gt;org.apache.cassandra.db.marshal.TimeUUIDType,b=&gt;org.apache.cassandra.db.marshal.BytesType,s=&gt;org.apache.cassandra.db.marshal.UTF8Type)'
 and default_validation_class = 'BytesType'  and key_validation_class = 'BytesType'  and
memtable_operations = 0.29062499999999997  and memtable_throughput = 62  and
memtable_flush_after = 1440  and rows_cached = 0.0  and row_cache_save_period = 0  and
keys_cached = 200000.0  and key_cache_save_period = 14400  and read_repair_chance = 1.0 
and gc_grace = 864000  and min_compaction_threshold = 4  and max_compaction_threshold = 32
 and replicate_on_write = true  and row_cache_provider =
'ConcurrentLinkedHashCacheProvider'  and column_metadata = [    {column_name :
'b@70617468',    validation_class : BytesType,    index_name : 'path',    index_type : 0},
   {column_name : 'b@73656e74696e656c',    validation_class : BytesType,    index_name :
'sentinel',    index_type : 0},    {column_name : 'b@706172656e745f70617468',   
validation_class : BytesType,    index_name : 'parent_path',    index_type :
0}];</pre></div></div>0.8.8 is not affected.Edit: Checked 0.8.9 and the cassandra-0.8
branch as well and saw the same thing. 


