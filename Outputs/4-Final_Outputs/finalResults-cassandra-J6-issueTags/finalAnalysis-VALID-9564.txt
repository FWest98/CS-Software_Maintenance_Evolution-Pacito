Pattern changes caused by commit: f1004e9b175d6593b816e72058b2dbea14257a43

From: Strategy-1
To:   Strategy-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-9564.txt 

commit f1004e9b175d6593b816e72058b2dbea14257a43
Author: Jonathan Ellis <jbellis@apache.org>

    update CqlRecordWriter interface
    patch by Alex Liu and jbellis for CASSANDRA-5622



==================================
 Issue CASSANDRA-5622 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-5622] Update CqlRecordWriter to conform to RecordWriter API
-----------------

-----------------
Summary: Update CqlRecordWriter to conform to RecordWriter API
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Thu, 6 Jun 2013 22:09:35 +0000
-----------------

-----------------
Resolved at: Mon, 17 Jun 2013 22:43:29 +0000
-----------------

-----------------
Assigned to: Alex Liu
-----------------

-----------------
Description: 

<tt>RecordWriter&lt;K, V&gt;</tt> is supposed to write values V that can be uniquely
identified by keys K.

Currently CqlRW requires the user to give it all the bind variables
for a complete statement in V, and effectively ignores K.
 

-----------------

-----------------
Comments: 

New Comment: 
Two solutions suggest themselves:<ol>	<li>Embrace ignoring of K and just pass new
Object()</li>	<li>Treat K as designed and accept responsibility for generating appropriate
bind variables</li></ol>I'm not a huge fan of #1 since it forces the user to do more work
to generate bind variables for the PK values.  I'd rather automate that.Let me give an
example of what I mean in #2.  Suppose we have word counts as follows:<div class="code
panel" style="border-width: 1px;"><div class="codeContent panelContent"><pre
class="code-java">CREATE TABLE word_counts (  file_name text,  counted_at timestamp,  word
text,  count <span class="code-object">int</span>,  PRIMARY KEY ((file_name, counted_at),
word));</pre></div></div>Then the user would configure CQL such as "UPDATE word_counts SET
count = ?".  CqlRW would inspect the table definition and realize it needs to add " WHERE
file_name = ? AND counted_at = ? AND word = ?".Then when it gets a Map&lt;String, BB&gt;
as K, it combines those with the List&lt;BB&gt; variables.  It knows the ordering of the
pk columns since it generated it itself.One downside: this doesn't lend itself to INSERT
statements, since that does not separate SET/WHERE the way UPDATE does.  This is a
limitation I can live with. 


New Comment: 
Agreed, #2 is more concise and easy to use. 


New Comment: 
patch for trunk is attached. 


New Comment: 
Patch for 1.2 branch is attached 


New Comment: 
Is it worth supporting INSERT at all since it's semantically identical to UPDATE?  I think
I'd rather just support UPDATE only and avoid the confusion of two different ways of
working. 


New Comment: 
I will disable INSERT query, only allow UPDATE or DELETE statement. 


New Comment: 
How is that coming, Alex?  Would like to ship this in 1.2.6. 


New Comment: 
I was busy with other project, I will get it done today. 


New Comment: 
<a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis"
class="user-hover" rel="jbellis">Jonathan Ellis</a> I attach the version 2 patches which
throws <div class="code panel" style="border-width: 1px;"><div class="codeContent
panelContent"><pre class="code-java">   IOException(<span class="code-quote">"INSERT
statement is depreciated and not supported, please use UPDATE/DELETE statement."</span>);
</pre></div></div>if the INSERT type query is used for writter. 


New Comment: 
Pushed a bunch of changes to <a href="https://github.com/jbellis/cassandra/commits/5622"
class="external-link"
rel="nofollow">https://github.com/jbellis/cassandra/commits/5622</a>. 


New Comment: 
+1 for the changes, <a
href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis"
class="user-hover" rel="jbellis">Jonathan Ellis</a> I can create the final patch. 


