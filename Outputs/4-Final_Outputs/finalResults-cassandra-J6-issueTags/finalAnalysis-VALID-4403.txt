Pattern changes caused by commit: 0b0d7eadfddeb16f22573f4ff1c31f4a1a0f006b

From: Mediator-2
To:   Mediator-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-4403.txt 

commit 0b0d7eadfddeb16f22573f4ff1c31f4a1a0f006b
Author: Sylvain Lebresne <slebresne@apache.org>

    Fix describeOwnership for OPP
    patch by jhermes; reviewed by slebresne for CASSANDRA-2800



==================================
 Issue CASSANDRA-2800 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-2800] OPP#describeOwnership reports incorrect ownership
-----------------

-----------------
Summary: OPP#describeOwnership reports incorrect ownership
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Mon, 20 Jun 2011 21:07:35 +0000
-----------------

-----------------
Resolved at: Wed, 6 Jul 2011 14:40:05 +0000
-----------------

-----------------
Assigned to: Jon Hermes
-----------------

-----------------
Description: 

OPP#describeOwnership relies on StorageService#getSplits and counts the received tokens
as its basis of ownership.

When the number of result keys is less than the number of
splits, the full count is omitted (to save work?). However, we don't care if a split would
end up fractional in this case, we just need the full count.

The logic here is:
<div
class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><pre
class="code-java"><span class="code-object">int</span> splits = keycount *
DatabaseDescriptor.getIndexInterval() / keysPerSplit;<span class="code-keyword">if</span>
(keycount &gt;= splits) { ... add count to result set }</pre></div></div>
We were passing
in 1 key per split (since we just care about the count), but splits=keycount*IndexInterval
is guaranteed to be &gt; keycount, so the result set is not completely formed.<br/>The
better "unit keysPerSplit" to use is IndexInterval itself, which gives
splits=keycount*II/II=keycount, so the logic runs correctly.
 

-----------------

-----------------
Comments: 

New Comment: 
+1<br/>Committed, thanks 


