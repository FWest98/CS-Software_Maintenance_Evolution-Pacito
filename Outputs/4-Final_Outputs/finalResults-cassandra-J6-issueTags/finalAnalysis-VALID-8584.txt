Pattern changes caused by commit: 082ea28cd7286e9882e60913444b322ea691fc3d

From: Abstract Factory-1
To:   Abstract Factory-2

From: Factory Method-1
To:   Factory Method-2

From: Decorator-2
To:   Decorator-1

From: Facade-0
To:   Facade-1

From: Flyweight-3
To:   Flyweight-1

From: Mediator-3
To:   Mediator-1

From: Strategy-0
To:   Strategy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-8584.txt 

commit 082ea28cd7286e9882e60913444b322ea691fc3d
Author: Vijay Parthasarathy <vijay2win@gmail.com>

    Unable to start when using Ec2Snitch
    Patch by Vijay, reviewed by Brandon Williams for CASSANDRA-5212



==================================
 Issue CASSANDRA-5212 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-5212] Unable to start when using Ec2Snitch
-----------------

-----------------
Summary: Unable to start when using Ec2Snitch
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Thu, 31 Jan 2013 21:37:28 +0000
-----------------

-----------------
Resolved at: Fri, 1 Feb 2013 20:38:28 +0000
-----------------

-----------------
Assigned to: Vijay
-----------------

-----------------
Description: 

Hello, we're using vanilla Cassandra in an EC2 environment and I just tested upgrading
from 1.2.0 to 1.2.1 on two test instances. Cassandra fails to start because it's unable to
load the Ec2Snitch. Version 1.2.0 was working OK. I have tried this on uninitialized/empty
instances and received the same result. Cassandra successfully starts when switching to
SimpleSnitch. Log output is below. We're using the official debian package from
apache.org. Please let me know if you need any more details, thanks!

output.log
<div
class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><pre
class="code-java">ERROR 21:25:06,684 Fatal configuration
errororg.apache.cassandra.exceptions.ConfigurationException: Error instantiating snitch
class <span class="code-quote">'org.apache.cassandra.locator.Ec2Snitch'</span>.	at
org.apache.cassandra.utils.FBUtilities.construct(FBUtilities.java:475)	at
org.apache.cassandra.config.DatabaseDescriptor.createEndpointSnitch(DatabaseDescriptor.java:525)	at
org.apache.cassandra.config.DatabaseDescriptor.loadYaml(DatabaseDescriptor.java:338)	at
org.apache.cassandra.config.DatabaseDescriptor.&lt;clinit&gt;(DatabaseDescriptor.java:122)	at
org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:151)	at
org.apache.cassandra.service.CassandraDaemon.init(CassandraDaemon.java:315)	at
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)	at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)	at
java.lang.reflect.Method.invoke(Method.java:616)	at
org.apache.commons.daemon.support.DaemonLoader.load(DaemonLoader.java:212)Caused by:
java.lang.reflect.InvocationTargetException	at
sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)	at
sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)	at
sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)	at
java.lang.reflect.Constructor.newInstance(Constructor.java:532)	at
org.apache.cassandra.utils.FBUtilities.construct(FBUtilities.java:457)	... 10 moreCaused
by: java.lang.ExceptionInInitializerError	at
org.apache.cassandra.locator.Ec2Snitch.&lt;init&gt;(Ec2Snitch.java:65)	... 15 moreCaused
by: java.lang.RuntimeException: Unable to read cassandra-rackdc.properties	at
org.apache.cassandra.locator.SnitchProperties.&lt;clinit&gt;(SnitchProperties.java:39)	...
16 moreCaused by: java.lang.NullPointerException	at
java.util.Properties$LineReader.readLine(Properties.java:435)	at
java.util.Properties.load0(Properties.java:354)	at
java.util.Properties.load(Properties.java:342)	at
org.apache.cassandra.locator.SnitchProperties.&lt;clinit&gt;(SnitchProperties.java:35)	...
16 moreError instantiating snitch class <span
class="code-quote">'org.apache.cassandra.locator.Ec2Snitch'</span>.Fatal configuration
error; unable to start server.  See log <span class="code-keyword">for</span>
stacktrace.Service exit with a <span class="code-keyword">return</span> value of
1</pre></div></div>
system.log
<div class="code panel" style="border-width: 1px;"><div
class="codeContent panelContent"><pre class="code-java">INFO [main] 2013-01-31
21:25:05,016 CassandraDaemon.java (line 123) JVM vendor/version: OpenJDK 64-Bit Server
VM/1.6.0_24&lt;SNIP&gt;ERROR [main] 2013-01-31 21:24:52,028 DatabaseDescriptor.java (line
509) Fatal configuration errororg.apache.cassandra.exceptions.ConfigurationException:
Error instantiating snitch class <span
class="code-quote">'org.apache.cassandra.locator.Ec2Snitch'</span>.	at
org.apache.cassandra.utils.FBUtilities.construct(FBUtilities.java:475)	at
org.apache.cassandra.config.DatabaseDescriptor.createEndpointSnitch(DatabaseDescriptor.java:525)	at
org.apache.cassandra.config.DatabaseDescriptor.loadYaml(DatabaseDescriptor.java:338)	at
org.apache.cassandra.config.DatabaseDescriptor.&lt;clinit&gt;(DatabaseDescriptor.java:122)	at
org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:151)	at
org.apache.cassandra.service.CassandraDaemon.init(CassandraDaemon.java:315)	at
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)	at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)	at
java.lang.reflect.Method.invoke(Method.java:616)	at
org.apache.commons.daemon.support.DaemonLoader.load(DaemonLoader.java:212)Caused by:
java.lang.reflect.InvocationTargetException	at
sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)	at
sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)	at
sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)	at
java.lang.reflect.Constructor.newInstance(Constructor.java:532)	at
org.apache.cassandra.utils.FBUtilities.construct(FBUtilities.java:457)	... 10 moreCaused
by: java.lang.ExceptionInInitializerError	at
org.apache.cassandra.locator.Ec2Snitch.&lt;init&gt;(Ec2Snitch.java:65)	... 15 moreCaused
by: java.lang.RuntimeException: Unable to read cassandra-rackdc.properties	at
org.apache.cassandra.locator.SnitchProperties.&lt;clinit&gt;(SnitchProperties.java:39)	...
16 moreCaused by: java.lang.NullPointerException	at
java.util.Properties$LineReader.readLine(Properties.java:435)	at
java.util.Properties.load0(Properties.java:354)	at
java.util.Properties.load(Properties.java:342)	at
org.apache.cassandra.locator.SnitchProperties.&lt;clinit&gt;(SnitchProperties.java:35)	...
16 more&lt;SNIP&gt; INFO [main] 2013-01-31 21:25:06,656 DatabaseDescriptor.java (line 267)
Global memtable threshold is enabled at 407MBERROR [main] 2013-01-31 21:25:06,684
DatabaseDescriptor.java (line 509) Fatal configuration
errororg.apache.cassandra.exceptions.ConfigurationException: Error instantiating snitch
class <span class="code-quote">'org.apache.cassandra.locator.Ec2Snitch'</span>.	at
org.apache.cassandra.utils.FBUtilities.construct(FBUtilities.java:475)	at
org.apache.cassandra.config.DatabaseDescriptor.createEndpointSnitch(DatabaseDescriptor.java:525)	at
org.apache.cassandra.config.DatabaseDescriptor.loadYaml(DatabaseDescriptor.java:338)	at
org.apache.cassandra.config.DatabaseDescriptor.&lt;clinit&gt;(DatabaseDescriptor.java:122)	at
org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:151)	at
org.apache.cassandra.service.CassandraDaemon.init(CassandraDaemon.java:315)	at
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)	at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)	at
java.lang.reflect.Method.invoke(Method.java:616)	at
org.apache.commons.daemon.support.DaemonLoader.load(DaemonLoader.java:212)Caused by:
java.lang.reflect.InvocationTargetException	at
sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)	at
sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)	at
sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)	at
java.lang.reflect.Constructor.newInstance(Constructor.java:532)	at
org.apache.cassandra.utils.FBUtilities.construct(FBUtilities.java:457)	... 10 moreCaused
by: java.lang.ExceptionInInitializerError	at
org.apache.cassandra.locator.Ec2Snitch.&lt;init&gt;(Ec2Snitch.java:65)	... 15 moreCaused
by: java.lang.RuntimeException: Unable to read cassandra-rackdc.properties	at
org.apache.cassandra.locator.SnitchProperties.&lt;clinit&gt;(SnitchProperties.java:39)	...
16 moreCaused by: java.lang.NullPointerException	at
java.util.Properties$LineReader.readLine(Properties.java:435)	at
java.util.Properties.load0(Properties.java:354)	at
java.util.Properties.load(Properties.java:342)	at
org.apache.cassandra.locator.SnitchProperties.&lt;clinit&gt;(SnitchProperties.java:35)	...
16 more</pre></div></div> 

-----------------

-----------------
Comments: 

New Comment: 
It tells you what the problem is:Caused by: java.lang.RuntimeException: Unable to read
cassandra-rackdc.properties 


New Comment: 
Thanks - I didn't see that needle in the (hay) stack. It looks like as a result of <a
href="https://issues.apache.org/jira/browse/CASSANDRA-5155" title="Make Ec2Region&#39;s
datacenter name configurable" class="issue-link"
data-issue-key="CASSANDRA-5155"><del>CASSANDRA-5155</del></a> the file
cassandra-rackdc.properties is now required to be in /etc/cassandra. However, this file is
not distributed with the standard Debian Cassandra package. Maybe this should be
documented in cassandra.yaml or the file should be distributed as part of the Debian
package? Thanks for your help. 


New Comment: 
Hmm, yes.  We should make it optional and/or add to the debian package. 


New Comment: 
+1, but instead of silently swallowing the exception maybe a WARN would be more
appropriate. 


New Comment: 
I agree with @driftx that we should add the WARN statement. Otherwise, +1 


