Pattern changes caused by commit: 4db44a486b4c496465a3f73048c709c224dfa830

From: Abstract Factory-3
To:   Abstract Factory-2

From: Factory Method-3
To:   Factory Method-2


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-3261.txt 

commit 4db44a486b4c496465a3f73048c709c224dfa830
Author: Jonathan Ellis <jbellis@apache.org>

    read saved caches with DataInputStream
    patch by mdennis; reviewed by jbellis for CASSANDRA-2174



==================================
 Issue CASSANDRA-2174 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-2174] saved caches written with BufferedRandomAccessFile cannot be read by ObjectInputStream
-----------------

-----------------
Summary: saved caches written with BufferedRandomAccessFile cannot be read by ObjectInputStream
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Wed, 16 Feb 2011 04:35:55 +0000
-----------------

-----------------
Resolved at: Wed, 16 Feb 2011 21:38:31 +0000
-----------------

-----------------
Assigned to: Matthew F. Dennis
-----------------

-----------------
Description: 

The CacheWriter is currently writing with BufferedRandomAccessFile which is incompatible
with ObjectInputStream resulting in stack traces about corrupted stream headers when
loading a saved cache.
 

-----------------

-----------------
Comments: 

New Comment: 
patch is on top of <a href="https://issues.apache.org/jira/browse/CASSANDRA-2172"
title="Saved-cache files are created for empty caches" class="issue-link"
data-issue-key="CASSANDRA-2172"><del>CASSANDRA-2172</del></a> 


New Comment: 
We don't use ObjectInputStream for cache reads anymore, and we need to use BRAF to get the
non-buffer-cache-clobbering effect on cache writes.We don't care about 0.7.0 reading
0.7.1/2 caches, since we made the choice to allow 0.7.1 to write new-format data files (<a
href="https://issues.apache.org/jira/browse/CASSANDRA-1555" title="Considerations for
larger bloom filters" class="issue-link"
data-issue-key="CASSANDRA-1555"><del>CASSANDRA-1555</del></a>) which is a much bigger
incompatibility.If 0.7.1/2 can't read 0.7.0, then we goofed, but changing it back
(breaking 0.7.2 -&gt; 0.7.3) seems like too late. 


New Comment: 
Oops, I applied the patch and <em>then</em> looked for uses of OIS.  Those operations are
not commutative. <img class="emoticon"
src="https://issues.apache.org/jira/images/icons/emoticons/smile.png" height="16"
width="16" align="absmiddle" alt="" border="0"/> 


New Comment: 
So...  the important fix is the CFS change, and the CacheWriter change is gratuitous? 


New Comment: 
I neglected to see the skipCache flag and was intending to make the read/write code
symmetric.attached patch contains only CFS change from OIS to DIS. 


New Comment: 
committed 


