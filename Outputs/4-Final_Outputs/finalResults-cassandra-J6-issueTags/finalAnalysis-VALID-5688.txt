Pattern changes caused by commit: 4020da3b9f31ecdde3e4facb14fce4612b58b1bb

From: Facade-1
To:   Facade-0


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-5688.txt 

commit 4020da3b9f31ecdde3e4facb14fce4612b58b1bb
Author: Brandon Williams <brandonwilliams@apache.org>

    Warn if gossip generation is from the future.
    Patch by Aaron Morton, reviewed by brandonwilliams for CASSANDRA-3654.



==================================
 Issue CASSANDRA-3654 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3654] Warn when the stored Gossip Generation is from the future
-----------------

-----------------
Summary: Warn when the stored Gossip Generation is from the future
-----------------

-----------------
Issue type: Improvement
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Tue, 20 Dec 2011 21:02:35 +0000
-----------------

-----------------
Resolved at: Thu, 22 Dec 2011 16:18:38 +0000
-----------------

-----------------
Assigned to: Aaron Morton
-----------------

-----------------
Description: 

I had a case where the server was first started with the current time set way in the
future. So the gossip generation was initialized with a very high value (background <a
href="http://thelastpickle.com/2011/12/15/Anatomy-of-a-Cassandra-Partition/"
class="external-link"
rel="nofollow">http://thelastpickle.com/2011/12/15/Anatomy-of-a-Cassandra-Partition/</a>)

There
were some other issues at play, but a log message warning of the high generation would
have helped. 
 

-----------------

-----------------
Comments: 

New Comment: 
As discussed, log if the future is from the future. 


New Comment: 
Can we mention this ticket in the patch so if people do encounter this they have an easier
avenue to pursue?I'll go ahead and add a little note here quoting your blog
post:<blockquote>I think in theory there is a danger that if we removed node #23 from the
ring and added another node with the same IP in less than 4 days it will have problems
with itâ€™s Generation not been seen as new. But thats a pretty small
danger.</blockquote>Yes, that would definitely be a problem, because removed states are
held until Gossiper.aVeryLongTime (after <a
href="https://issues.apache.org/jira/browse/CASSANDRA-2496" title="Gossip should handle
&#39;dead&#39; states" class="issue-link"
data-issue-key="CASSANDRA-2496"><del>CASSANDRA-2496</del></a>) which is 3 days (I quoted
you 4 just to be safe.)  If the removed generation is in the future and thus higher than
the joining node, the new node won't be able to communicate any state for either that IP
<b>or</b> that token.  The easiest thing to do in this situation is bootstrap the new node
on a different IP at token-1, removetoken the existing token, wait 3 days, and if you
really care about having the old IP or token back move it after that.  You can also use
this as an alternate solution to the problem, though you <em>must</em> wipe at least the
system keyspace on the node before bootstrapping it back in. 


New Comment: 
Version2 - adds a comment about gossip generation and this ticket number. 


