Pattern changes caused by commit: 59a6a5d82dc088dac8f1d98bc48a6426d75dc1a2

From: Decorator-2
To:   Decorator-1

From: Flyweight-2
To:   Flyweight-1

From: Mediator-3
To:   Mediator-1

From: Strategy-0
To:   Strategy-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-7586.txt 

commit 59a6a5d82dc088dac8f1d98bc48a6426d75dc1a2
Author: Pavel Yaskevich <xedin@apache.org>

    Pluggable Thrift transport factories for CLI
    patch by Jason Brown and Pavel Yaskevich; reviewed by Pavel Yaskevich for CASSANDRA-4609



==================================
 Issue CASSANDRA-4609 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-4609] Add thrift transport factory impl to cassandra-cli
-----------------

-----------------
Summary: Add thrift transport factory impl to cassandra-cli
-----------------

-----------------
Issue type: Sub-task
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Tue, 4 Sep 2012 13:41:15 +0000
-----------------

-----------------
Resolved at: Thu, 4 Oct 2012 05:25:28 +0000
-----------------

-----------------
Assigned to: Jason Brown
-----------------

-----------------
Description: 
 

-----------------

-----------------
Comments: 

New Comment: 
add thrift transport factory support to cassandra-cli. Modified the client to optionally
use the client encryptions (thrift ssl) and to use the new ITransportFactory design. 


New Comment: 
This doesn't look like what I had in mind, the reason to have transport factory is to
remove all the branching we already have - e.g. if (sessionState.framed) or socket
considerations, and let pluggable transport factory to generate the correct transport in
one line. I think it should be done in a way that allows users to pass --transport-factory
as a parameter to the cassandra-cli script or if it wasn't given use some default factory.
So actually if you want SSL enabled sockets, you can pass it something like
TThriftSSLFactory which on getTransport() would generate SSL TSocket and return it as
TTransport without checking anything directly in CliMain. What do you think, Jake? 


New Comment: 
Yeah, I think it should be generic 


New Comment: 
We want to have factory in generic form because we are planing to support various
transports which should not depend on any external checks for framing etc. on the user
side. 


New Comment: 
Sorry for the delay. Ok, part of the reason there's a little bit of a dance going on here
is that it wasn't clear to me that the ticket name 'Add thrift transport factory' didn't
map 1-to-1 with the existing ITransportFactory interface. Hence, that's why thew submitted
code may look a little contorted trying to shoehorn that interface into a more general
high level factory for thrift transports. I'll rework this patch, as well as <a
href="https://issues.apache.org/jira/browse/CASSANDRA-4608" title="Add thrift server
factory to CassandraDaemon" class="issue-link"
data-issue-key="CASSANDRA-4608"><del>CASSANDRA-4608</del></a>/<a
href="https://issues.apache.org/jira/browse/CASSANDRA-4662" title="Core support for Thrift
SSL integration" class="issue-link"
data-issue-key="CASSANDRA-4662"><del>CASSANDRA-4662</del></a>. 


New Comment: 
Jason, Can you add a ITransportFactory configuration option in cassandra.yaml, so that the
cassandra-cli can use any plugin TransportFactory. 


New Comment: 
Alex, Pavel and I discussed offline, and it seems best to be able to pass the name of
transport factory as a command line arg, --transport_factory. 


New Comment: 
that works as well. 


New Comment: 
After discussing offline with Pavel, a more generic implementation, based upon using the
TTransportFactory class as a base is submitted here. Further, to release the configurable
transport factory with the 1.1 release, we're removing the dependency upon thrift SSL
integration until 1.2 (see <a href="https://issues.apache.org/jira/browse/CASSANDRA-4239"
title="Support Thrift SSL socket" class="issue-link"
data-issue-key="CASSANDRA-4239"><del>CASSANDRA-4239</del></a>). I'll create the
client-side thrift SSL integration as part of finalizing <a
href="https://issues.apache.org/jira/browse/CASSANDRA-4239" title="Support Thrift SSL
socket" class="issue-link" data-issue-key="CASSANDRA-4239"><del>CASSANDRA-4239</del></a>. 


New Comment: 
(attaching correct file this time...) 


New Comment: 
file 4609_cass1.1.patch should apply to the 1.2 branch, as well. 


New Comment: 
attaching v2 to show how I want transport-factories to be done for CLI, what do you think
Jason? 


New Comment: 
Yes, looks a little simpler than mine (which used the CliTransportFactory as an
intermediary factory). LGTM, +1. 


