Pattern changes caused by commit: baf130094938ac03a91844cd5c3a70f54d5bcff3

From: Flyweight-1
To:   Flyweight-3

From: Mediator-1
To:   Mediator-2


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-6405.txt 

commit baf130094938ac03a91844cd5c3a70f54d5bcff3
Author: Pavel Yaskevich <xedin@apache.org>

    fix KEYS index from skipping results
    patch by Pavel Yaskevich; reviewed by Jonathan Ellis for CASSANDRA-3996



==================================
 Issue CASSANDRA-3996 Description 
=======================================

Project: Cassandra
-----------------

-----------------
Title: [CASSANDRA-3996] Keys index skips results
-----------------

-----------------
Summary: Keys index skips results
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Sun, 4 Mar 2012 11:03:45 +0000
-----------------

-----------------
Resolved at: Tue, 27 Mar 2012 22:25:37 +0000
-----------------

-----------------
Assigned to: Pavel Yaskevich
-----------------

-----------------
Description: 

While scanning results page if range index meets result already seen in previous result
set it decreases columnsRead that causes next iteration to treat
columsRead&lt;rowsPerQuery as if last page was not full and scan is done.
 

-----------------

-----------------
Comments: 

New Comment: 
This patch also refactors keysSearcher for more generic way. It creates method
nextIndexKey for generic index searchers that is suitable for indexes that return results
from multiple indexCfs rows.Created in Wikimart.ru 


New Comment: 
git diff output 


New Comment: 
Committed with CodeStyle refactoring, thanks! 


New Comment: 
So...  is this a real bug fix?  We should add a test case if so and commit to 1.1.0 if not
1.0.9. 


New Comment: 
yeah, this is a real thing. Dmitry, can you work on the test-case? I have already
committed it to 1.1.1, should I revert? 


New Comment: 
it may or may not be easier to merge forwards if we revert the current changes first. 
hard to say with git. <img class="emoticon"
src="https://issues.apache.org/jira/images/icons/emoticons/smile.png" height="16"
width="16" align="absmiddle" alt="" border="0"/> 


New Comment: 
imho it's easier to revert and recommit to the right versions if only to ensure changelog
entries ends up where they should. 


New Comment: 
Reverted from 1.1 and trunk 


New Comment: 
This bug was introduced by (3297a96e1849f41d9c61f024282ed52d642e0794 - Merge
get_indexed_slices with get_range_slices) in 1.1.0 and does not affect 1.0.x versions,
attached patch adds test along side with updated code. 


New Comment: 
v2 with actual change to the KeysSearcher.getIndexedIterator method (no refactoring) and
test-case. 


New Comment: 
+1 on v2I'm not necessarily against doing the rest of this refactor in another ticket,
since &#8211; and I think this is the goal &#8211; it sets us up to do a merge of results
from multiple indexes), but I'd like to see more comments describing the code organization
for a relatively large change like that.  (From a quick look, it also looks like changing
"return endOfData" to "resetState" is unnecessary &#8211; I prefer the former since it
makes it clear that once you get to this point in the code, the iterator is finished.) 


