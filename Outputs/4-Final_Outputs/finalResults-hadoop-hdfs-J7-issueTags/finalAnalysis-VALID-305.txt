Pattern changes caused by commit: 6e3aa3ec2b61c624588f5867962f24e412279e9e

From: Mediator-0
To:   Mediator-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-305.txt 

commit 6e3aa3ec2b61c624588f5867962f24e412279e9e
Author: Konstantin I Boudnik <cos@apache.org>

    HDFS-741. TestHFlush test doesn't seek() past previously written part of the file. Contributed by Konstantin Boudnik



==================================
 Issue HDFS-741 Description 
=======================================

Project: Hadoop HDFS
-----------------

-----------------
Title: [HDFS-741] TestHFlush test doesn't seek() past previously written part of the file
-----------------

-----------------
Summary: TestHFlush test doesn't seek() past previously written part of the file
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Closed
-----------------

-----------------
Created at: Wed, 28 Oct 2009 23:56:52 +0000
-----------------

-----------------
Resolved at: Mon, 16 Nov 2009 22:29:29 +0000
-----------------

-----------------
Assigned to: Konstantin I Boudnik
-----------------

-----------------
Description: 

As a part of the test scenario a file is being written, 10th of the total length in a
time. Then a reader is opened to read what has been just written and hflush'ed. However,
it always starts reading from the 0 position of the file and doesn't seek to the start of
the portion written last.
 

-----------------

-----------------
Comments: 

New Comment: 
This fixes the seek problem.However, two testcases (writing cross block and checksum
boundaries) are failing.<br/>From the sizes of a block and checksum is seems that I can't
seek over block boundary and it might be a limitation of the test... I'm not sure.... 


New Comment: 
Cos, could you please try verifying the whole file instead of the newly hflushed data.
This way we can identify if this is a bug of seek or a bug of hflush. 


New Comment: 
With this one it is much more apparent that <tt>seek()</tt> is failing. 


New Comment: 
I have verified it: the whole file reads Ok. I've simply commented out
<tt>checkData(..)</tt> call inside of the loop and tests start passing. Seems to me as a
<tt>seek()</tt>} problem. 


New Comment: 
<div class="code panel" style="border-width: 1px;"><div class="codeContent
panelContent"><pre class="code-java">+        <span class="code-object">int</span>
readBytes = is.read(toRead, 0, tenth);+        assertEquals(<span
class="code-quote">"Should've get more bytes"</span>, tenth,
readBytes);</pre></div></div>Why expecting (tenth == readBytes)? 
java.io.DataInputStream.read(..) may read some number of bytes up to the given length but
not necessary all the bytes, i.e. it is okay if we have (0 &lt; readBytes &lt;= tenth). 


New Comment: 
It seems that you're right. However, the point is still valid although is slightly
different: I'm able to read &gt;0 bytes after seek. However, they content is filled with
'0' rather then with something the test is writing into the file. Slightly modified
version of the test to demonstrate just that. 


New Comment: 
&gt; It seems that you're right. However, the point is still valid although is slightly
different: I'm able to read &gt;0 bytes after seek. However, they content is filled with
'0' rather then with something the test is writing into the file. Slightly modified
version of the test to demonstrate just that.Hi Cos, checkData(..) should check only byte
0 to (readBytes-1).  h741_20091112.patch works in my machine.h741_20091112.patch: changed
checkData(..). 


New Comment: 
Yes, you're right. My bad. Thanks for correcting it. 


New Comment: 
Latest patch by Nicholas seems to be fixing the issue 


New Comment: 
-1 overall.  Here are the results of testing the latest attachment <br/>  <a
href="http://issues.apache.org/jira/secure/attachment/12424785/h741_20091112.patch"
class="external-link"
rel="nofollow">http://issues.apache.org/jira/secure/attachment/12424785/h741_20091112.patch</a><br/>
 against trunk revision 835534.    +1 @author.  The patch does not contain any @author
tags.    +1 tests included.  The patch appears to include 3 new or modified tests.    +1
javadoc.  The javadoc tool did not generate any warning messages.    +1 javac.  The
applied patch does not increase the total number of javac compiler warnings.    +1
findbugs.  The patch does not introduce any new Findbugs warnings.    +1 release audit. 
The applied patch does not increase the total number of release audit warnings.    -1 core
tests.  The patch failed core unit tests.    +1 contrib tests.  The patch passed contrib
unit tests.Test results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/75/testReport/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/75/testReport/</a><br/>Findbugs
warnings: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/75/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/75/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html</a><br/>Checkstyle
results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/75/artifact/trunk/build/test/checkstyle-errors.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/75/artifact/trunk/build/test/checkstyle-errors.html</a><br/>Console
output: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/75/console"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/75/console</a>This
message is automatically generated. 


New Comment: 
+1 patch looks good.Test failures are expected and are addressed by <a
href="https://issues.apache.org/jira/browse/HDFS-706" title="Intermittent failures in
TestFiHFlush" class="issue-link" data-issue-key="HDFS-706"><del>HDFS-706</del></a>. As
soon as <a href="https://issues.apache.org/jira/browse/HDFS-706" title="Intermittent
failures in TestFiHFlush" class="issue-link"
data-issue-key="HDFS-706"><del>HDFS-706</del></a> is reviewed, I'm going to commit this
modification, run test-patch for <a href="https://issues.apache.org/jira/browse/HDFS-706"
title="Intermittent failures in TestFiHFlush" class="issue-link"
data-issue-key="HDFS-706"><del>HDFS-706</del></a> and commit it as well to minimize time
of broken test-patch. 


New Comment: 
This patch has to be merged to branch 0.21. <br/>Few testcases in <tt>TestFiHFlush</tt>
will start failing after this patch. <a
href="https://issues.apache.org/jira/browse/HDFS-706" title="Intermittent failures in
TestFiHFlush" class="issue-link" data-issue-key="HDFS-706"><del>HDFS-706</del></a> will
fix them shortly.I've just committed this. 


New Comment: 
Integrated in Hadoop-Hdfs-trunk-Commit #113 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/113/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/113/</a>)<br/>
   . TestHFlush test doesn't seek() past previously written part of the file. Contributed
by Konstantin Boudnik 


New Comment: 
Integrated in Hadoop-Hdfs-trunk #145 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk/145/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk/145/</a>) 


New Comment: 
Integrated in Hdfs-Patch-h5.grid.sp2.yahoo.net #118 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/118/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/118/</a>) 


