Pattern changes caused by commit: ebf99d57aa3338b779c79909f6aabd5685c36efc

From: Mediator-0
To:   Mediator-1


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-384.txt 

commit ebf99d57aa3338b779c79909f6aabd5685c36efc
Author: Thomas White <tomwhite@apache.org>

    HDFS-914. Refactor DFSOutputStream and DFSInputStream out of DFSClient. Contributed by Todd Lipcon.



==================================
 Issue HDFS-914 Description 
=======================================

Project: Hadoop HDFS
-----------------

-----------------
Title: [HDFS-914] Refactor DFSOutputStream and DFSInputStream out of DFSClient
-----------------

-----------------
Summary: Refactor DFSOutputStream and DFSInputStream out of DFSClient
-----------------

-----------------
Issue type: Improvement
-----------------

-----------------
Current status: Resolved
-----------------

-----------------
Created at: Fri, 22 Jan 2010 23:57:39 +0000
-----------------

-----------------
Resolved at: Thu, 4 Feb 2010 22:20:22 +0000
-----------------

-----------------
Assigned to: Todd Lipcon
-----------------

-----------------
Description: 

I'd like to propose refactoring DFSClient to extract DFSOutputStream and DFSInputStream
into a new org.apache.hadoop.hdfs.client package. DFSClient has become unmanageably large,
containing 8 inner classes.and approaching 4kloc. Factoring out the non-static inner
classes will also make them easier to test in isolation.
 

-----------------

-----------------
Comments: 

New Comment: 
Here's a patch which refactors DFSInputStream, DFSOutputStream, and BlockReader out of
DFSClient. I didn't make anything factory-ified - it's just a straight eclipse refactor
plus a bit of cleanup/addition of accessors.There could probably be a bit more cleanup
later, but as is this is an improvement in my opinion. 


New Comment: 
-1 overall.  Here are the results of testing the latest attachment <br/>  <a
href="http://issues.apache.org/jira/secure/attachment/12431817/hdfs-914.txt"
class="external-link"
rel="nofollow">http://issues.apache.org/jira/secure/attachment/12431817/hdfs-914.txt</a><br/>
 against trunk revision 903906.    +1 @author.  The patch does not contain any @author
tags.    +1 tests included.  The patch appears to include 42 new or modified tests.    +1
javadoc.  The javadoc tool did not generate any warning messages.    +1 javac.  The
applied patch does not increase the total number of javac compiler warnings.    +1
findbugs.  The patch does not introduce any new Findbugs warnings.    -1 release audit. 
The applied patch generated 120 release audit warnings (more than the trunk's current 117
warnings).    +1 core tests.  The patch passed core unit tests.    -1 contrib tests.  The
patch failed contrib unit tests.Test results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/testReport/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/testReport/</a><br/>Release
audit warnings: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/artifact/trunk/patchprocess/releaseAuditDiffWarnings.txt"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/artifact/trunk/patchprocess/releaseAuditDiffWarnings.txt</a><br/>Findbugs
warnings: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html</a><br/>Checkstyle
results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/artifact/trunk/build/test/checkstyle-errors.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/artifact/trunk/build/test/checkstyle-errors.html</a><br/>Console
output: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/console"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/212/console</a>This
message is automatically generated. 


New Comment: 
Fixes release audit warnings and a few style nits. 


New Comment: 
-1 overall.  Here are the results of testing the latest attachment <br/>  <a
href="http://issues.apache.org/jira/secure/attachment/12431846/hdfs-914.txt"
class="external-link"
rel="nofollow">http://issues.apache.org/jira/secure/attachment/12431846/hdfs-914.txt</a><br/>
 against trunk revision 903906.    +1 @author.  The patch does not contain any @author
tags.    +1 tests included.  The patch appears to include 42 new or modified tests.    +1
javadoc.  The javadoc tool did not generate any warning messages.    +1 javac.  The
applied patch does not increase the total number of javac compiler warnings.    +1
findbugs.  The patch does not introduce any new Findbugs warnings.    +1 release audit. 
The applied patch does not increase the total number of release audit warnings.    +1 core
tests.  The patch passed core unit tests.    -1 contrib tests.  The patch failed contrib
unit tests.Test results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/214/testReport/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/214/testReport/</a><br/>Findbugs
warnings: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/214/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/214/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html</a><br/>Checkstyle
results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/214/artifact/trunk/build/test/checkstyle-errors.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/214/artifact/trunk/build/test/checkstyle-errors.html</a><br/>Console
output: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/214/console"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h5.grid.sp2.yahoo.net/214/console</a>This
message is automatically generated. 


New Comment: 
Failing test is TextProxyUtil (caused by <a
href="https://issues.apache.org/jira/browse/HDFS-936" title="TestProxyUtil failing
test-patch builds" class="issue-link" data-issue-key="HDFS-936"><del>HDFS-936</del></a>).
Everything else looks good.If people are on board with this, It would be good to commit
rather quickly to avoid merge conflicts against any other patch that touches DFSClient. 


New Comment: 
+1 This looks good to me. I agree that this should be committed soon, so I'd like to do so
in the next couple of days unless anyone has objections. 


New Comment: 
Patch got out of date by <a href="https://issues.apache.org/jira/browse/HDFS-927"
title="DFSInputStream retries too many times for new block locations" class="issue-link"
data-issue-key="HDFS-927"><del>HDFS-927</del></a> being committed. 


New Comment: 
New patch that incorporates <a href="https://issues.apache.org/jira/browse/HDFS-927"
title="DFSInputStream retries too many times for new block locations" class="issue-link"
data-issue-key="HDFS-927"><del>HDFS-927</del></a>'s fixes in the refactored classes. 


New Comment: 
-1 overall.  Here are the results of testing the latest attachment <br/>  <a
href="http://issues.apache.org/jira/secure/attachment/12434789/hdfs-914.txt"
class="external-link"
rel="nofollow">http://issues.apache.org/jira/secure/attachment/12434789/hdfs-914.txt</a><br/>
 against trunk revision 905873.    +1 @author.  The patch does not contain any @author
tags.    +1 tests included.  The patch appears to include 45 new or modified tests.    +1
javadoc.  The javadoc tool did not generate any warning messages.    +1 javac.  The
applied patch does not increase the total number of javac compiler warnings.    +1
findbugs.  The patch does not introduce any new Findbugs warnings.    +1 release audit. 
The applied patch does not increase the total number of release audit warnings.    -1 core
tests.  The patch failed core unit tests.    -1 contrib tests.  The patch failed contrib
unit tests.Test results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/testReport/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/testReport/</a><br/>Findbugs
warnings: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html</a><br/>Checkstyle
results: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/artifact/trunk/build/test/checkstyle-errors.html"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/artifact/trunk/build/test/checkstyle-errors.html</a><br/>Console
output: <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/console"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/112/console</a>This
message is automatically generated. 


New Comment: 
+1 on commit. 


New Comment: 
I've just committed this. Thanks Todd! 


New Comment: 
Integrated in Hadoop-Hdfs-trunk-Commit #186 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/186/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hadoop-Hdfs-trunk-Commit/186/</a>)<br/>
   . Refactor DFSOutputStream and DFSInputStream out of DFSClient. Contributed by Todd
Lipcon. 


New Comment: 
This did not get approval from Hudson and still was committed. I don't see any comments
about failed tests, and I don't see any jiras filed about that. 


New Comment: 
The failed tests were unrelated - those same errors have shown up on a lot of test-builds
recently. I ran TestDatanodeBlockScanner locally on a patched tree and it passed. Sorry
that I didn't comment here. 


New Comment: 
The failures seem to be the same as <a
href="https://issues.apache.org/jira/browse/HDFS-615" title="TestLargeDirectoryDelete
fails with NullPointerException" class="issue-link"
data-issue-key="HDFS-615"><del>HDFS-615</del></a> and <a
href="https://issues.apache.org/jira/browse/HDFS-833"
title="TestDiskError.testReplicationError fails with locked storage error "
class="issue-link" data-issue-key="HDFS-833"><del>HDFS-833</del></a> - the NN storage has
an "already locked" error, and then the test fails because the NN isn't in a good state. 


New Comment: 
"already locked" is the consequence of the initial error in
<tt>TestDatanodeBlockScanner.testDatanodeBlockScanner()</tt>, which is<div class="code
panel" style="border-width: 1px;"><div class="codeContent panelContent"><pre
class="code-java">java.io.FileNotFoundException: http:<span
class="code-comment">//localhost:53291/blockScannerReport?listblocks</span>	at
sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1288)	at
org.apache.hadoop.hdfs.DFSTestUtil.urlGet(DFSTestUtil.java:286)	at
org.apache.hadoop.hdfs.TestDatanodeBlockScanner.waitForVerification(TestDatanodeBlockScanner.java:70)	at
org.apache.hadoop.hdfs.TestDatanodeBlockScanner.testDatanodeBlockScanner(TestDatanodeBlockScanner.java:129)</pre></div></div>Then
the test fails to exit all threads, and the directory remains locked for subsequent
tests.<br/>I think we should file a separate issue for fixing
<tt>TestDatanodeBlockScanner</tt>. 


New Comment: 
Integrated in Hdfs-Patch-h2.grid.sp2.yahoo.net #146 (See <a
href="http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/146/"
class="external-link"
rel="nofollow">http://hudson.zones.apache.org/hudson/job/Hdfs-Patch-h2.grid.sp2.yahoo.net/146/</a>) 


