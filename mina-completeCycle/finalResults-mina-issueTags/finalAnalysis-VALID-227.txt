Pattern changes caused by commit: b7280d51151ea735019edf0f9686bff661656020

From: Facade-23
To:   Facade-24


=========================
       NEW GIT LOG
=========================

This commit refers to file: VALID-227.txt 

commit b7280d51151ea735019edf0f9686bff661656020
Author: Niklas Therning <niklas@apache.org>

    Resolved DIRMINA-229 as suggested by Oleg Kalnichevski. The IoSessionOutputStream.write() methods will now block until the bytes have been written. If the write fails or the session has been closed an IOException will be thrown. The close() method will also block now.



==================================
 Issue DIRMINA-229 Description 
=======================================

Project: MINA
-----------------

-----------------
Title: [DIRMINA-229] IoSessionOutputStream write methods should not return before the I/O operation is fully completed
-----------------

-----------------
Summary: IoSessionOutputStream write methods should not return before the I/O operation is fully completed
-----------------

-----------------
Issue type: Bug
-----------------

-----------------
Current status: Closed
-----------------

-----------------
Created at: Sun, 30 Jul 2006 12:10:38 +0000
-----------------

-----------------
Resolved at: Tue, 1 Aug 2006 18:35:56 +0000
-----------------

-----------------
Assigned to: Niklas Therning
-----------------

-----------------
Description: 

IoSessionOutputStream write methods return before the I/O operation is fully completed,
which causes issues in protocol handlers based on blocking InputStream/OutputStream model.
Is it a desired behaviour?

Per discussion with Peter Royal on the HttpComponents mailing
list I am working on a simple HTTP server based on MINA and HttpComponents Core.  HttpCore
does not work with the latest SVN snapshot of MINA without this patch (attached)

Oleg
 

-----------------

-----------------
Comments: 

New Comment: 
Please reviewOleg 


New Comment: 
I think this problem is very bad since things could get very, very messed up if you wrap
one of these stream instances in e.g. a BufferedOutputStream. I'm not sure whether we want
non blocking writes here. If we use join() as suggested in Oleg's patch we could also
check isWritten() on the WriteFuture and throw an IOException if it couldn't be written.
WDYT?BTW, the patch looks great. I have no objections. But I would like to add the
isWritten() check as well. I'll go ahead and apply it right away. 


New Comment: 
I've made the changes as suggested by Oleg. I've also readded the code which joins on the
CloseFuture in IoSessionOutputStream.close(). I think it is safe to have it there now when
we also join on the writes. I've also added code which throws IOException if a write fails
or if the session isn't connected when trying to write. I think this is more in line with
the contract of InputStream. 


New Comment: 
That fixed the problem for me. Thanks a bunchOleg 


New Comment: 
Wouldn't we need a property that allows a user to swith the synchronous operations into
the asynchronous one? 


